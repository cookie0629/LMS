# LMS å¼€å‘æ—¥å¿—

## é¡¹ç›®æ¦‚è¿°

æœ¬é¡¹ç›®æ˜¯ä»é›¶å¼€å§‹å­¦ä¹ å¹¶æ„å»º Lightweight Music Server (LMS) éŸ³ä¹æµåª’ä½“æœåŠ¡å™¨çš„å®Œæ•´å¼€å‘è¿‡ç¨‹è®°å½•ã€‚

**å¼€å‘æ¨¡å¼**ï¼šå‚è€ƒæ¨¡æ¿é¡¹ç›®ï¼Œä½†ä¸ç›´æ¥å¤åˆ¶ä»£ç ï¼Œå®Œå…¨æ‰‹å†™å®ç°  
**å¼€å‘è¯­è¨€**ï¼šC++20  
**æ„å»ºç³»ç»Ÿ**ï¼šCMake  
**å¼€å‘ç¯å¢ƒ**ï¼šWSL2 (Windows Subsystem for Linux)

---

## å¼€å‘é˜¶æ®µè®°å½•

### é˜¶æ®µ 0ï¼šç¯å¢ƒæ­å»ºï¼ˆå·²å®Œæˆ âœ…ï¼‰

**æ—¶é—´**ï¼šé¡¹ç›®å¯åŠ¨åˆæœŸ

**å®Œæˆå†…å®¹**ï¼š
1. åˆ›å»ºé¡¹ç›®ç›®å½•ç»“æ„
2. é…ç½® WSL2 å¼€å‘ç¯å¢ƒ
3. å®‰è£… Wt æ¡†æ¶ï¼ˆC++ Web Toolkitï¼‰
4. é…ç½® pkg-config è·¯å¾„
5. è§£å†³ Wt å›¾åƒå®ç°ä¾èµ–é—®é¢˜ï¼ˆä½¿ç”¨ STB è€Œé GraphicsMagickï¼‰
6. åˆ›å»ºåŸºç¡€ CMake é…ç½®
7. åˆ›å»º `.gitignore` æ–‡ä»¶

**é‡åˆ°çš„é—®é¢˜**ï¼š
- Wt æ¡†æ¶å®‰è£…æ—¶æ‰¾ä¸åˆ° GraphicsMagick â†’ æ”¹ç”¨ Wt å†…ç½® STB å›¾åƒå®ç°
- pkg-config æ‰¾ä¸åˆ° Wt â†’ æ‰‹åŠ¨åˆ›å»º `wt.pc` æ–‡ä»¶å¹¶é…ç½®è·¯å¾„

**å…³é”®æ–‡ä»¶**ï¼š
- `scripts/install-wt.sh` - Wt å®‰è£…è„šæœ¬
- `scripts/complete-wt-setup.sh` - Wt å®Œæ•´é…ç½®è„šæœ¬
- `scripts/configure-project.sh` - é¡¹ç›®é…ç½®è„šæœ¬
- `.envrc` - ç¯å¢ƒå˜é‡é…ç½®

---

### é˜¶æ®µ 1ï¼šCore åº“åŸºç¡€ï¼ˆå·²å®Œæˆ âœ…ï¼‰

**æ—¶é—´**ï¼šç¯å¢ƒæ­å»ºå

**ç›®æ ‡**ï¼šå®ç°æ ¸å¿ƒå·¥å…·ç±»å’ŒåŸºç¡€åŠŸèƒ½

#### 1.1 Path å·¥å…·ç±»

**è®¾è®¡æ€è·¯**ï¼ˆå‚è€ƒæ¨¡æ¿ï¼‰ï¼š
- ä½¿ç”¨å‘½åç©ºé—´ `lms::core::pathUtils` ç»„ç»‡å·¥å…·å‡½æ•°
- ä½¿ç”¨ `std::filesystem` è¿›è¡Œè·¯å¾„æ“ä½œ
- æä¾›æ–‡ä»¶æ‰©å±•åæ£€æŸ¥ã€è·¯å¾„éªŒè¯ã€è·¯å¾„æ¸…ç†ç­‰åŠŸèƒ½

**å®ç°å†…å®¹**ï¼š
- `hasFileAnyExtension()` - æ£€æŸ¥æ–‡ä»¶æ˜¯å¦æœ‰æŒ‡å®šæ‰©å±•å
- `isPathInRootPath()` - éªŒè¯è·¯å¾„æ˜¯å¦åœ¨æ ¹è·¯å¾„å†…
- `getLongestCommonPath()` - è·å–æœ€é•¿å…¬å…±è·¯å¾„
- `sanitizeFileStem()` - æ¸…ç†æ–‡ä»¶åï¼ˆç§»é™¤éæ³•å­—ç¬¦ï¼‰

**æ–‡ä»¶**ï¼š
- `src/libs/core/include/core/Path.hpp`
- `src/libs/core/impl/Path.cpp`
- `src/libs/core/test/test_path.cpp`

**æµ‹è¯•ç»“æœ**ï¼šâœ… æ‰€æœ‰æµ‹è¯•é€šè¿‡

#### 1.2 String å·¥å…·ç±»

**è®¾è®¡æ€è·¯**ï¼ˆå‚è€ƒæ¨¡æ¿ï¼‰ï¼š
- ä½¿ç”¨å‘½åç©ºé—´ `lms::core::stringUtils` ç»„ç»‡å·¥å…·å‡½æ•°
- ä½¿ç”¨ `std::string_view` æé«˜æ€§èƒ½
- æä¾›å­—ç¬¦ä¸²åˆ†å‰²ã€è¿æ¥ã€ä¿®å‰ªã€å¤§å°å†™è½¬æ¢ç­‰åŠŸèƒ½

**å®ç°å†…å®¹**ï¼š
- `splitString()` - åˆ†å‰²å­—ç¬¦ä¸²
- `joinStrings()` - è¿æ¥å­—ç¬¦ä¸²
- `trimString()` - ä¿®å‰ªå­—ç¬¦ä¸²
- `stringToLower()` / `stringToUpper()` - å¤§å°å†™è½¬æ¢
- `stringCaseInsensitiveEqual()` - å¤§å°å†™ä¸æ•æ„Ÿæ¯”è¾ƒ
- `capitalize()` - é¦–å­—æ¯å¤§å†™

**æ–‡ä»¶**ï¼š
- `src/libs/core/include/core/String.hpp`
- `src/libs/core/impl/String.cpp`
- `src/libs/core/test/test_string.cpp`

**æµ‹è¯•ç»“æœ**ï¼šâœ… æ‰€æœ‰æµ‹è¯•é€šè¿‡

#### 1.3 Random å·¥å…·ç±»

**è®¾è®¡æ€è·¯**ï¼ˆå‚è€ƒæ¨¡æ¿ï¼‰ï¼š
- ä½¿ç”¨å‘½åç©ºé—´ `lms::core::random` ç»„ç»‡å·¥å…·å‡½æ•°
- ä½¿ç”¨ `thread_local` ç¡®ä¿çº¿ç¨‹å®‰å…¨
- æä¾›éšæœºæ•°ç”Ÿæˆã€å®¹å™¨æ‰“ä¹±ã€éšæœºé€‰æ‹©ç­‰åŠŸèƒ½

**å®ç°å†…å®¹**ï¼š
- `getRandGenerator()` - è·å–çº¿ç¨‹å±€éƒ¨éšæœºæ•°ç”Ÿæˆå™¨
- `createSeededGenerator()` - åˆ›å»ºå¸¦ç§å­çš„ç”Ÿæˆå™¨
- `getRandom()` - ç”Ÿæˆéšæœºæ•´æ•°ï¼ˆæ¨¡æ¿å‡½æ•°ï¼‰
- `getRealRandom()` - ç”Ÿæˆéšæœºæµ®ç‚¹æ•°ï¼ˆæ¨¡æ¿å‡½æ•°ï¼‰
- `shuffleContainer()` - æ‰“ä¹±å®¹å™¨ï¼ˆæ¨¡æ¿å‡½æ•°ï¼‰
- `pickRandom()` - ä»å®¹å™¨ä¸­éšæœºé€‰æ‹©ï¼ˆæ¨¡æ¿å‡½æ•°ï¼‰

**æ–‡ä»¶**ï¼š
- `src/libs/core/include/core/Random.hpp`
- `src/libs/core/impl/Random.cpp`

**æµ‹è¯•ç»“æœ**ï¼šâœ… æ‰€æœ‰æµ‹è¯•é€šè¿‡

#### 1.4 UUID ç±»

**è®¾è®¡æ€è·¯**ï¼ˆå‚è€ƒæ¨¡æ¿ï¼‰ï¼š
- ä½¿ç”¨ç±»å°è£… UUID åŠŸèƒ½
- å®ç° UUID v4 æ ‡å‡†
- ä½¿ç”¨æ­£åˆ™è¡¨è¾¾å¼éªŒè¯ UUID æ ¼å¼

**å®ç°å†…å®¹**ï¼š
- `UUID::fromString()` - ä»å­—ç¬¦ä¸²è§£æ UUID
- `UUID::generate()` - ç”Ÿæˆ UUID v4
- `getAsString()` - è·å–å­—ç¬¦ä¸²è¡¨ç¤º
- æ¯”è¾ƒæ“ä½œç¬¦ï¼ˆä½¿ç”¨ C++20 çš„ `operator<=>`ï¼‰

**æ–‡ä»¶**ï¼š
- `src/libs/core/include/core/UUID.hpp`
- `src/libs/core/impl/UUID.cpp`
- `src/libs/core/test/test_uuid.cpp`

**é‡åˆ°çš„é—®é¢˜**ï¼š
- åˆå§‹å®ç° UUID v4 æ—¶ï¼Œç‰ˆæœ¬ä½å’Œå˜ä½“ä½è®¾ç½®ä¸æ­£ç¡® â†’ ä¿®å¤ä¸ºç¬¦åˆ UUID v4 æ ‡å‡†

**æµ‹è¯•ç»“æœ**ï¼šâœ… æ‰€æœ‰æµ‹è¯•é€šè¿‡

**Git æäº¤**ï¼š
- `feat: å®ç°Pathå·¥å…·ç±»å®Œæ•´åŠŸèƒ½`
- `feat: å®ç°Stringå·¥å…·ç±»å®Œæ•´åŠŸèƒ½`
- `feat: å®ç°Randomå’ŒUUIDç”ŸæˆåŠŸèƒ½`

---

### é˜¶æ®µ 2ï¼šé…ç½®å’Œæ—¥å¿—ç³»ç»Ÿï¼ˆå·²å®Œæˆ âœ…ï¼‰

**æ—¶é—´**ï¼šCore åº“åŸºç¡€å®Œæˆå

#### 2.1 é…ç½®ç³»ç»Ÿ (IConfig)

**è®¾è®¡æ€è·¯**ï¼ˆå‚è€ƒæ¨¡æ¿ï¼‰ï¼š
- ä½¿ç”¨æ¥å£ `IConfig` å®šä¹‰é…ç½®è®¿é—®æŠ½è±¡
- ä½¿ç”¨ `libconfig++` åº“è§£æé…ç½®æ–‡ä»¶
- å®ç° `Config` ç±»ä½œä¸ºå…·ä½“å®ç°
- æ”¯æŒå¤šç§ç±»å‹ï¼šstring, path, unsigned long, long, bool
- æ”¯æŒå¤šå€¼å­—ç¬¦ä¸²é…ç½®ï¼ˆæ•°ç»„ï¼‰

**å®ç°å†…å®¹**ï¼š
- `IConfig` æ¥å£å®šä¹‰
- `Config` ç±»å®ç°
- `getString()` - è·å–å­—ç¬¦ä¸²é…ç½®
- `getPath()` - è·å–è·¯å¾„é…ç½®
- `getULong()` / `getLong()` - è·å–æ•´æ•°é…ç½®
- `getBool()` - è·å–å¸ƒå°”é…ç½®
- `visitStrings()` - è®¿é—®å¤šå€¼å­—ç¬¦ä¸²é…ç½®

**æ–‡ä»¶**ï¼š
- `src/libs/core/include/core/IConfig.hpp`
- `src/libs/core/impl/Config.hpp`
- `src/libs/core/impl/Config.cpp`
- `src/libs/core/test/test_config.cpp`
- `conf/lms.conf` - é…ç½®æ–‡ä»¶ç¤ºä¾‹

**æµ‹è¯•ç»“æœ**ï¼šâœ… æ‰€æœ‰æµ‹è¯•é€šè¿‡

#### 2.2 Service æ¨¡å¼

**è®¾è®¡æ€è·¯**ï¼ˆå‚è€ƒæ¨¡æ¿ï¼‰ï¼š
- å®ç°æœåŠ¡å®šä½å™¨æ¨¡å¼
- ä½¿ç”¨æ¨¡æ¿ç±» `Service<T>` ç®¡ç†å…¨å±€æœåŠ¡
- æ”¯æŒä¾èµ–æ³¨å…¥
- ä½¿ç”¨é™æ€æˆå‘˜å­˜å‚¨æœåŠ¡å®ä¾‹

**å®ç°å†…å®¹**ï¼š
- `Service` æ¨¡æ¿ç±»
- `get()` - è·å–æœåŠ¡å®ä¾‹
- `assign()` - æ³¨å†ŒæœåŠ¡å®ä¾‹
- `exists()` - æ£€æŸ¥æœåŠ¡æ˜¯å¦å­˜åœ¨

**æ–‡ä»¶**ï¼š
- `src/libs/core/include/core/Service.hpp`

#### 2.3 æ—¥å¿—ç³»ç»Ÿ (ILogger)

**è®¾è®¡æ€è·¯**ï¼ˆå‚è€ƒæ¨¡æ¿ï¼‰ï¼š
- ä½¿ç”¨æ¥å£ `ILogger` å®šä¹‰æ—¥å¿—æŠ½è±¡
- å®ç° `Logger` ç±»æ”¯æŒæ–‡ä»¶å’Œæ§åˆ¶å°è¾“å‡º
- ä½¿ç”¨ `Log` ç±»æ„å»ºæ—¥å¿—æ¶ˆæ¯ï¼ˆRAII æ¨¡å¼ï¼‰
- æ”¯æŒå¤šä¸ªä¸¥é‡çº§åˆ«ï¼šFATAL, ERROR, WARNING, INFO, DEBUG
- æ”¯æŒå¤šä¸ªæ¨¡å—æ ‡è¯†
- çº¿ç¨‹å®‰å…¨çš„æ—¥å¿—è¾“å‡º

**å®ç°å†…å®¹**ï¼š
- `ILogger` æ¥å£å®šä¹‰
- `Logger` ç±»å®ç°
- `Log` ç±»ï¼ˆRAII æ¨¡å¼ï¼‰
- `getModuleName()` / `getSeverityName()` - åç§°è½¬æ¢å‡½æ•°
- `LMS_LOG` / `LMS_LOG_IF` - æ—¥å¿—å®

**é‡åˆ°çš„é—®é¢˜**ï¼š
- `DEBUG` æ˜¯é¢„å®šä¹‰å®ï¼Œä¸æšä¸¾å€¼å†²çª â†’ ä½¿ç”¨ `DEBUG_LEVEL` å¹¶å®šä¹‰å®åˆ«å

**æ–‡ä»¶**ï¼š
- `src/libs/core/include/core/ILogger.hpp`
- `src/libs/core/impl/Logger.hpp`
- `src/libs/core/impl/Logger.cpp`
- `src/libs/core/test/test_logger.cpp`

**æµ‹è¯•ç»“æœ**ï¼šâœ… æ‰€æœ‰æµ‹è¯•é€šè¿‡

**Git æäº¤**ï¼ˆå‡†å¤‡ä¸­ï¼‰ï¼š
- `feat: å®ç°é…ç½®ç³»ç»Ÿ(IConfig)`
- `feat: å®ç°æ—¥å¿—ç³»ç»Ÿ(ILogger)å’ŒServiceæ¨¡å¼`

---

### é˜¶æ®µ 3ï¼šæ•°æ®åº“åŸºç¡€ï¼ˆè¿›è¡Œä¸­ ğŸš§ï¼‰

**æ—¶é—´**ï¼šé…ç½®å’Œæ—¥å¿—ç³»ç»Ÿå®Œæˆå

**ç›®æ ‡**ï¼šå®ç°æ•°æ®åº“è®¿é—®å±‚ï¼Œä½¿ç”¨ Wt::Dbo ORM æ¡†æ¶

#### 3.1 æ•°æ®åº“åŸºç¡€æ¶æ„ï¼ˆå·²å®Œæˆ âœ…ï¼‰

**è®¾è®¡æ€è·¯**ï¼ˆå‚è€ƒæ¨¡æ¿ï¼‰ï¼š
- ä½¿ç”¨ `IDb` æ¥å£å®šä¹‰æ•°æ®åº“æŠ½è±¡
- ä½¿ç”¨ `Session` ç±»å°è£… Wt::Dbo::Session
- å®ç° `Transaction` ç±»ç®¡ç†äº‹åŠ¡ï¼ˆReadTransaction, WriteTransactionï¼‰
- ä½¿ç”¨ `Object` æ¨¡æ¿åŸºç±»å®šä¹‰æ•°æ®å¯¹è±¡
- ä½¿ç”¨ `IdType` å’Œ `TaggedType` å®ç°å¼ºç±»å‹ ID

**å®ç°å†…å®¹**ï¼š
- `IDb` æ¥å£å®šä¹‰
- `Db` ç±»å®ç°ï¼ˆè¿æ¥æ± ã€TLS ä¼šè¯ç®¡ç†ï¼‰
- `Session` ç±»å®ç°ï¼ˆè¡¨æ˜ å°„ã€æŸ¥è¯¢æ–¹æ³•ï¼‰
- `Transaction` ç±»ï¼ˆReadTransaction, WriteTransactionï¼‰
- `Object` æ¨¡æ¿åŸºç±»
- `ObjectPtr` æ¨¡æ¿ç±»
- `IdType` å’Œ `TaggedType` æ”¯æŒ
- `Types.hpp` - Range, RangeResults ç­‰ç±»å‹å®šä¹‰

**æ–‡ä»¶**ï¼š
- `src/libs/database/include/database/IDb.hpp`
- `src/libs/database/impl/Db.hpp`
- `src/libs/database/impl/Db.cpp`
- `src/libs/database/include/database/Session.hpp`
- `src/libs/database/impl/Session.cpp`
- `src/libs/database/include/database/Transaction.hpp`
- `src/libs/database/impl/Transaction.cpp`
- `src/libs/database/include/database/Object.hpp`
- `src/libs/database/impl/Object.cpp`
- `src/libs/database/include/database/IdType.hpp`
- `src/libs/core/include/core/TaggedType.hpp`
- `src/libs/database/include/database/Types.hpp`
- `src/libs/database/CMakeLists.txt`

**é‡åˆ°çš„é—®é¢˜**ï¼š
1. Wt::Dbo::Transaction æ„é€ å‡½æ•°ä¸æ¥å—ç¬¬äºŒä¸ªå‚æ•° â†’ ä¿®å¤ä¸ºåªä¼  Session å¼•ç”¨
2. Object ç±»ä¸­ `IdType` ä¸å‘½åç©ºé—´ä¸­çš„ `IdType` ç±»åå†²çª â†’ æ”¹ä¸º `ObjectId`
3. Session::execute() æ–¹æ³•ä¸å­˜åœ¨ â†’ æ”¹ä¸ºé€šè¿‡ Db ç±»æ‰§è¡Œ SQL

**æµ‹è¯•ç»“æœ**ï¼šâœ… ç¼–è¯‘é€šè¿‡

**å½“å‰è¿›åº¦**ï¼š60% å®Œæˆ

#### 3.2 User æ•°æ®å¯¹è±¡å®ç°ï¼ˆè¿›è¡Œä¸­ ğŸš§ï¼‰

**è®¾è®¡æ€è·¯**ï¼ˆå‚è€ƒæ¨¡æ¿ï¼‰ï¼š
- å®ç°ç¬¬ä¸€ä¸ªæ•°æ®æ¨¡å‹ User
- ä½¿ç”¨ Wt::Dbo ORM è¿›è¡Œå¯¹è±¡å…³ç³»æ˜ å°„
- æ”¯æŒç”¨æˆ·ç±»å‹ï¼ˆREGULAR, ADMIN, DEMOï¼‰
- å®ç°å¯†ç å“ˆå¸Œå­˜å‚¨
- å®ç°åŸºæœ¬çš„æŸ¥è¯¢æ–¹æ³•

**å®ç°å†…å®¹**ï¼š
- `UserId` IDç±»å‹å®šä¹‰
- `User` ç±»å®ç°ï¼ˆç®€åŒ–ç‰ˆï¼‰
- `UserType` æšä¸¾å®šä¹‰
- `Utils` å·¥å…·ç±»ï¼ˆSQLæ‰§è¡Œè¾…åŠ©ï¼‰
- åœ¨ Session ä¸­æ˜ å°„ User ç±»

**æ–‡ä»¶**ï¼š
- `src/libs/database/include/database/objects/UserId.hpp`
- `src/libs/database/include/database/objects/User.hpp`
- `src/libs/database/impl/objects/User.cpp`
- `src/libs/database/include/database/Utils.hpp`
- `src/libs/database/impl/Utils.cpp`

**é‡åˆ°çš„é—®é¢˜**ï¼š
1. `LMS_DECLARE_IDTYPE` å®å®šä¹‰ä½ç½®é—®é¢˜ â†’ ç§»åˆ°å‘½åç©ºé—´å¤–
2. `UserId` ç»§æ‰¿æ£€æŸ¥å¤±è´¥ â†’ ä¿®å¤å®å®šä¹‰
3. `find` æ–¹æ³•è¿”å›ç±»å‹è½¬æ¢ â†’ ä½¿ç”¨ `Wt::Dbo::ptr` ç„¶åè½¬æ¢ä¸º `ObjectPtr`
4. `Utils::executeCommand` å®ç° â†’ ä½¿ç”¨äº‹åŠ¡æ‰§è¡ŒSQL

**é‡åˆ°çš„é—®é¢˜**ï¼š
1. `LMS_DECLARE_IDTYPE` å®å®šä¹‰ä½ç½®é—®é¢˜ â†’ ç§»åˆ°å‘½åç©ºé—´å¤–
2. `UserId` ç»§æ‰¿æ£€æŸ¥å¤±è´¥ â†’ ä¿®å¤å®å®šä¹‰
3. `find` æ–¹æ³•è¿”å›ç±»å‹è½¬æ¢ â†’ ä½¿ç”¨ `Wt::Dbo::ptr` ç„¶åè½¬æ¢ä¸º `ObjectPtr`
4. `Utils::executeCommand` å®ç° â†’ é€šè¿‡ Session::execute æ‰§è¡ŒSQL

**æµ‹è¯•ç»“æœ**ï¼šâœ… ç¼–è¯‘é€šè¿‡

**å½“å‰è¿›åº¦**ï¼š80% å®Œæˆ

#### 3.3 æ•°æ®åº“è¿ç§»ç³»ç»Ÿå®ç°ï¼ˆè¿›è¡Œä¸­ ğŸš§ï¼‰

**è®¾è®¡æ€è·¯**ï¼ˆå‚è€ƒæ¨¡æ¿ï¼‰ï¼š
- å®ç°ç‰ˆæœ¬ç®¡ç†ç³»ç»Ÿï¼ˆVersionInfoï¼‰
- æ”¯æŒæ•°æ®åº“æ¶æ„ç‰ˆæœ¬å‡çº§
- ä½¿ç”¨è¿ç§»å‡½æ•°æ˜ å°„è¡¨ç®¡ç†ä¸åŒç‰ˆæœ¬çš„è¿ç§»
- ç®€åŒ–ç‰ˆæœ¬ï¼šåªæ”¯æŒåˆå§‹ç‰ˆæœ¬ï¼ˆç‰ˆæœ¬1ï¼‰

**å®ç°å†…å®¹**ï¼š
- `VersionInfo` ç±»ï¼šå­˜å‚¨æ•°æ®åº“ç‰ˆæœ¬å·
- `Migration` å‘½åç©ºé—´ï¼šè¿ç§»é€»è¾‘
- `doDbMigration` å‡½æ•°ï¼šæ‰§è¡Œè¿ç§»
- `ScopedNoForeignKeys`ï¼šä¸´æ—¶ç¦ç”¨å¤–é”®çº¦æŸ
- åœ¨ Session ä¸­é›†æˆè¿ç§»åŠŸèƒ½

**æ–‡ä»¶**ï¼š
- `src/libs/database/include/database/Migration.hpp`
- `src/libs/database/impl/Migration.cpp`

**é‡åˆ°çš„é—®é¢˜**ï¼š
1. `VersionInfo::getOrCreate` æ‰¾ä¸åˆ° â†’ éœ€è¦åŒ…å« `Wt::Dbo` å¤´æ–‡ä»¶
2. `resultValue()` æ–¹æ³•ä¸å­˜åœ¨ â†’ æ”¹ç”¨ `resultList()` è·å–ç»“æœ
3. `WriteTransaction` å‰å‘å£°æ˜é—®é¢˜ â†’ åŒ…å« `Transaction.hpp`
4. `Wt::WDateTime` SQL traits é—®é¢˜ â†’ åŒ…å« `WtSqlTraits.h`

**æµ‹è¯•ç»“æœ**ï¼šâœ… ç¼–è¯‘é€šè¿‡ï¼ˆæœ‰æœªä½¿ç”¨å˜é‡è­¦å‘Šï¼Œä¸å½±å“åŠŸèƒ½ï¼‰

**å½“å‰è¿›åº¦**ï¼š100% å®Œæˆ âœ…

#### 3.4 ä¸‹ä¸€æ­¥å·¥ä½œï¼ˆå¾…å®ç°ï¼‰

1. **Db ç±»å®ç°**
   - è¿æ¥æ± ç®¡ç†
   - TLS ä¼šè¯ç®¡ç†
   - SQLite è¿æ¥é…ç½®

2. **Session å®Œæ•´åŠŸèƒ½**
   - è¡¨æ˜ å°„ï¼ˆmapClassï¼‰
   - æŸ¥è¯¢æ–¹æ³•
   - æ•°æ®åº“åˆå§‹åŒ–

3. **User æ•°æ®å¯¹è±¡**
   - å®ç°ç¬¬ä¸€ä¸ªæ•°æ®æ¨¡å‹
   - ç”¨æˆ·è®¤è¯ç›¸å…³å­—æ®µ

4. **æ•°æ®åº“è¿ç§»ç³»ç»Ÿ**
   - ç‰ˆæœ¬ç®¡ç†
   - è¿ç§»è„šæœ¬

---

## æŠ€æœ¯å†³ç­–è®°å½•

### 1. Wt å›¾åƒå®ç°é€‰æ‹©

**é—®é¢˜**ï¼šWt æ¡†æ¶é»˜è®¤ä½¿ç”¨ GraphicsMagickï¼Œä½†å®‰è£…å¤æ‚  
**å†³ç­–**ï¼šä½¿ç”¨ Wt å†…ç½®çš„ STB å›¾åƒå®ç°ï¼ˆ`WT_WRASTERIMAGE_IMPLEMENTATION=Wt`ï¼‰  
**åŸå› **ï¼šå‡å°‘å¤–éƒ¨ä¾èµ–ï¼Œç®€åŒ–éƒ¨ç½²

### 2. UUID v4 å®ç°

**é—®é¢˜**ï¼šåˆå§‹å®ç°ä¸ç¬¦åˆ UUID v4 æ ‡å‡†  
**å†³ç­–**ï¼šä¸¥æ ¼æŒ‰ç…§ UUID v4 è§„èŒƒå®ç°ç‰ˆæœ¬ä½å’Œå˜ä½“ä½  
**åŸå› **ï¼šç¡®ä¿ç”Ÿæˆçš„ UUID ç¬¦åˆæ ‡å‡†ï¼Œå¯è¢«å…¶ä»–ç³»ç»Ÿè¯†åˆ«

### 3. DEBUG å®å†²çª

**é—®é¢˜**ï¼š`DEBUG` æ˜¯é¢„å®šä¹‰å®ï¼Œä¸æ—¥å¿—ä¸¥é‡çº§åˆ«æšä¸¾å†²çª  
**å†³ç­–**ï¼šä½¿ç”¨ `DEBUG_LEVEL` ä½œä¸ºæšä¸¾å€¼ï¼Œå¹¶å®šä¹‰å®åˆ«å  
**åŸå› **ï¼šä¿æŒä»£ç å¯è¯»æ€§ï¼ŒåŒæ—¶é¿å…å®å†²çª

### 4. æ•°æ®åº“ ORM é€‰æ‹©

**å†³ç­–**ï¼šä½¿ç”¨ Wt::Dbo ORM æ¡†æ¶  
**åŸå› **ï¼š
- æ¨¡æ¿é¡¹ç›®ä½¿ç”¨æ­¤æ¡†æ¶
- ä¸ Wt Web æ¡†æ¶é›†æˆè‰¯å¥½
- æ”¯æŒ SQLiteï¼ˆé€‚åˆè½»é‡çº§æœåŠ¡å™¨ï¼‰

---

## å­¦ä¹ æ”¶è·

### 1. C++20 ç‰¹æ€§åº”ç”¨

- `std::string_view` - é«˜æ•ˆå­—ç¬¦ä¸²å¤„ç†
- `std::filesystem` - æ–‡ä»¶ç³»ç»Ÿæ“ä½œ
- `std::span` - æ•°ç»„è§†å›¾
- `operator<=>` - ä¸‰è·¯æ¯”è¾ƒè¿ç®—ç¬¦
- `thread_local` - çº¿ç¨‹å±€éƒ¨å­˜å‚¨

### 2. è®¾è®¡æ¨¡å¼åº”ç”¨

- **å·¥å…·å‡½æ•°å‘½åç©ºé—´æ¨¡å¼** - Path, String å·¥å…·ç±»
- **æ¥å£/å®ç°åˆ†ç¦»** - IConfig, ILogger
- **æœåŠ¡å®šä½å™¨æ¨¡å¼** - Service æ¨¡æ¿ç±»
- **RAII æ¨¡å¼** - Log ç±»ã€Transaction ç±»
- **æ¨¡æ¿å…ƒç¼–ç¨‹** - Object åŸºç±»ã€TaggedType

### 3. CMake æœ€ä½³å®è·µ

- æ¨¡å—åŒ– CMakeLists.txt
- æ­£ç¡®çš„ä¾èµ–ç®¡ç†
- æµ‹è¯•ç›®æ ‡é…ç½®

### 4. å¼€å‘æµç¨‹

- æ¸è¿›å¼ Git æäº¤
- æµ‹è¯•é©±åŠ¨å¼€å‘
- ä»ç®€å•åˆ°å¤æ‚çš„å®ç°é¡ºåº

---

## å¾…è§£å†³é—®é¢˜

1. **æ•°æ®åº“è¿æ¥æ± é…ç½®** - éœ€è¦å®ç° Db ç±»çš„å®Œæ•´åŠŸèƒ½
2. **æ•°æ®åº“è¿ç§»ç³»ç»Ÿ** - éœ€è¦è®¾è®¡ç‰ˆæœ¬ç®¡ç†æœºåˆ¶
3. **äº‹åŠ¡æ£€æŸ¥æœºåˆ¶** - éœ€è¦å®ç° TransactionCheckerï¼ˆè°ƒè¯•æ¨¡å¼ï¼‰

---

## ä¸‹ä¸€æ­¥è®¡åˆ’

1. å®Œæˆ Db ç±»å®ç°ï¼ˆè¿æ¥æ± ã€TLS ä¼šè¯ï¼‰
2. å®Œæˆ Session å®Œæ•´åŠŸèƒ½ï¼ˆè¡¨æ˜ å°„ã€æŸ¥è¯¢ï¼‰
3. å®ç° User æ•°æ®å¯¹è±¡
4. å®ç°æ•°æ®åº“è¿ç§»ç³»ç»Ÿ
5. é›†æˆæµ‹è¯•

---

**æœ€åæ›´æ–°**ï¼š2025-11-22  
**å½“å‰é˜¶æ®µ**ï¼šé˜¶æ®µ 3 - æ•°æ®åº“åŸºç¡€ï¼ˆå®Œæˆ âœ…ï¼‰

---

## æœ€æ–°è¿›å±•ï¼ˆ2025-11-22ï¼‰

### æ•°æ®åº“è¿ç§»ç³»ç»Ÿå®ç°å®Œæˆ âœ…

æˆåŠŸå®ç°äº†æ•°æ®åº“è¿ç§»ç³»ç»Ÿï¼ŒåŒ…æ‹¬ï¼š
- VersionInfo ç±»ï¼šå­˜å‚¨å’Œç®¡ç†æ•°æ®åº“ç‰ˆæœ¬å·
- Migration å‘½åç©ºé—´ï¼šè¿ç§»é€»è¾‘å°è£…
- doDbMigration å‡½æ•°ï¼šæ‰§è¡Œç‰ˆæœ¬å‡çº§
- ScopedNoForeignKeysï¼šä¸´æ—¶ç¦ç”¨å¤–é”®çº¦æŸï¼ˆè¿ç§»æ—¶ä½¿ç”¨ï¼‰
- Session é›†æˆï¼šåœ¨ prepareTablesIfNeeded ä¸­è°ƒç”¨è¿ç§»

**å…³é”®å®ç°ç‚¹**ï¼š
- ç‰ˆæœ¬ç®¡ç†ï¼šä½¿ç”¨ VersionInfo è¡¨å­˜å‚¨å½“å‰æ•°æ®åº“ç‰ˆæœ¬
- è¿ç§»æœºåˆ¶ï¼šæ”¯æŒä»æ—§ç‰ˆæœ¬é€æ­¥å‡çº§åˆ°æœ€æ–°ç‰ˆæœ¬
- ç®€åŒ–ç‰ˆæœ¬ï¼šå½“å‰åªæ”¯æŒç‰ˆæœ¬ 1ï¼ˆåˆå§‹ç‰ˆæœ¬ï¼‰
- å…¼å®¹æ€§æ£€æŸ¥ï¼šé˜²æ­¢ä½¿ç”¨è¿‡æ—§çš„æœåŠ¡å™¨äºŒè¿›åˆ¶æ–‡ä»¶

**é˜¶æ®µ 3 æ€»ç»“**ï¼š
- âœ… æ•°æ®åº“åŸºç¡€æ¶æ„å®Œæˆ
- âœ… User æ•°æ®å¯¹è±¡å®ç°
- âœ… æ•°æ®åº“è¿ç§»ç³»ç»Ÿå®ç°
- âœ… æ‰€æœ‰ä»£ç ç¼–è¯‘é€šè¿‡

**ä¸‹ä¸€æ­¥**ï¼šè¿›å…¥é˜¶æ®µ 4ï¼Œå®ç°æœåŠ¡å±‚å’Œä¸šåŠ¡é€»è¾‘

---

## é˜¶æ®µ 4ï¼šæœåŠ¡å±‚ - Auth Serviceï¼ˆè¿›è¡Œä¸­ ğŸš§ 70%ï¼‰

**å¼€å§‹æ—¶é—´**ï¼š2025-11-22

### 4.1 Auth Service åŸºç¡€æ¶æ„ï¼ˆè¿›è¡Œä¸­ ğŸš§ï¼‰

**è®¾è®¡æ€è·¯**ï¼ˆå‚è€ƒæ¨¡æ¿ï¼‰ï¼š
- å®ç°è®¤è¯æœåŠ¡ï¼ˆAuth Serviceï¼‰
- æ”¯æŒå¤šç§è®¤è¯åç«¯ï¼ˆInternalã€PAMã€HTTP Headersï¼‰
- å®ç°å¯†ç æœåŠ¡å’Œè®¤è¯ä»¤ç‰ŒæœåŠ¡
- ä½¿ç”¨æ¥å£æ¨¡å¼ï¼Œä¾¿äºæ‰©å±•

**å®ç°è®¡åˆ’**ï¼š
1. åˆ›å»º Auth Service ç›®å½•ç»“æ„
2. å®ç° Types.hppï¼ˆç±»å‹å®šä¹‰ï¼‰
3. å®ç° IPasswordService æ¥å£
4. å®ç° IAuthTokenService æ¥å£
5. å®ç° InternalPasswordServiceï¼ˆåŸºäºæ•°æ®åº“çš„å¯†ç éªŒè¯ï¼‰
6. å®ç° AuthTokenServiceï¼ˆè®¤è¯ä»¤ç‰Œç®¡ç†ï¼‰
7. å®ç° AuthServiceï¼ˆä¸»è®¤è¯æœåŠ¡ï¼‰

**å®ç°å†…å®¹**ï¼š
- åˆ›å»º Services ç›®å½•ç»“æ„
- åˆ›å»º Auth Service åŸºç¡€æ¶æ„
- å®ç° Types.hppï¼ˆç±»å‹å®šä¹‰å’Œå¼‚å¸¸ç±»ï¼‰
- å®ç° IPasswordService æ¥å£

**æ–‡ä»¶**ï¼š
- `src/libs/services/CMakeLists.txt`
- `src/libs/services/auth/CMakeLists.txt`
- `src/libs/services/auth/include/services/auth/Types.hpp`
- `src/libs/services/auth/include/services/auth/IPasswordService.hpp`
- `src/libs/services/auth/impl/*.cpp`ï¼ˆå ä½æ–‡ä»¶ï¼‰

**å½“å‰è¿›åº¦**ï¼š60% å®Œæˆ

**å®ç°å†…å®¹**ï¼š
- âœ… AuthServiceBase ç±»ï¼ˆæ•°æ®åº“ä¼šè¯è®¿é—®ã€ç”¨æˆ·ç®¡ç†ï¼‰
- âœ… LoginThrottler ç±»ï¼ˆç™»å½•é™æµå™¨ï¼‰
- âœ… PasswordServiceBase ç±»ï¼ˆå¯†ç æœåŠ¡åŸºç±»ï¼‰
- âœ… InternalPasswordService ç±»ï¼ˆå†…éƒ¨å¯†ç æœåŠ¡å®ç°ï¼Œä½¿ç”¨ bcryptï¼‰
- âœ… createPasswordService å·¥å‚å‡½æ•°
- âœ… IAuthTokenService æ¥å£å®šä¹‰
- âœ… AuthTokenService ç±»ï¼ˆç®€åŒ–ç‰ˆå®ç°ï¼‰

**è§£å†³çš„é—®é¢˜**ï¼š
1. âœ… Object::getId() æ–¹æ³•ä¸­çš„ UserId æ„é€ æ­§ä¹‰é—®é¢˜
   - é—®é¢˜ï¼šUserId ç»§æ‰¿è‡ª IdTypeï¼ŒIdType æœ‰å¤šä¸ªæ„é€ å‡½æ•°ï¼Œå¯¼è‡´æ„é€ æ­§ä¹‰
   - è§£å†³æ–¹æ¡ˆï¼šåœ¨ IdType ä¸­ç¦ç”¨ TaggedType çš„æ„é€ å‡½æ•°ï¼Œåªä¿ç•™ explicit IdType(ValueType)
   - ç»“æœï¼šç¼–è¯‘é€šè¿‡ï¼Œæ„é€ æ­§ä¹‰å·²è§£å†³

**æ–‡ä»¶**ï¼š
- `src/libs/services/auth/impl/AuthServiceBase.hpp/cpp`
- `src/libs/services/auth/impl/LoginThrottler.hpp/cpp`
- `src/libs/services/auth/impl/PasswordServiceBase.hpp/cpp`
- `src/libs/services/auth/impl/internal/InternalPasswordService.hpp/cpp`
- `src/libs/services/auth/include/services/auth/IAuthTokenService.hpp`
- `src/libs/services/auth/impl/AuthTokenService.hpp/cpp`

**æœ€æ–°è¿›å±•**ï¼ˆ2025-11-22 ç»§ç»­ï¼‰ï¼š
- âœ… å®ç°äº† AuthToken æ•°æ®å¯¹è±¡ï¼ˆAuthTokenIdã€AuthToken ç±»ï¼‰
- âœ… åœ¨ User ä¸­æ·»åŠ äº† AuthToken å…³è”
- âœ… åœ¨ Session ä¸­æ˜ å°„äº† AuthToken
- âœ… å®ç°äº† Utils å·¥å…·å‡½æ•°ï¼ˆfetchQuerySingleResultã€forEachQueryResultï¼‰
- âœ… ä¿®å¤äº†ç¼–è¯‘é”™è¯¯ï¼ˆå¤´æ–‡ä»¶åŒ…å«ã€ç±»å‹è½¬æ¢ç­‰ï¼‰
- âœ… å®Œå–„äº† AuthTokenService å®ç°ï¼ˆä½¿ç”¨ AuthToken æ•°æ®å¯¹è±¡ï¼‰
  - å®ç°äº† `createAuthToken`ï¼ˆåˆ›å»ºè®¤è¯ä»¤ç‰Œï¼‰
  - å®ç°äº† `processAuthToken`ï¼ˆå¤„ç†è®¤è¯ä»¤ç‰Œï¼ŒåŒ…æ‹¬è¿‡æœŸæ£€æŸ¥å’Œé™æµï¼‰
  - å®ç°äº† `visitAuthTokens`ï¼ˆè®¿é—®ç”¨æˆ·çš„æ‰€æœ‰ä»¤ç‰Œï¼‰
  - å®ç°äº† `clearAuthTokens`ï¼ˆæ¸…é™¤ç”¨æˆ·ä»¤ç‰Œï¼‰
  - å®ç°äº† `registerDomain`ï¼ˆæ³¨å†ŒåŸŸå‚æ•°ï¼‰
  - å®ç°äº† `getDomainParameters`ï¼ˆè·å–åŸŸå‚æ•°ï¼‰

**å½“å‰çŠ¶æ€**ï¼š
- âœ… æ‰€æœ‰ä»£ç ç¼–è¯‘é€šè¿‡
- âœ… AuthTokenService å®Œæ•´å®ç°å®Œæˆ

**æœ€æ–°è¿›å±•**ï¼ˆ2025-11-22 æµ‹è¯•å®Œæˆï¼‰ï¼š
- âœ… åˆ›å»ºäº† Auth Service æµ‹è¯•ç¨‹åºï¼ˆtest_auth.cppï¼‰
- âœ… æµ‹è¯•ç¨‹åºç¼–è¯‘æˆåŠŸ
- âœ… **æ‰€æœ‰ 13 ä¸ªæµ‹è¯•ç”¨ä¾‹å…¨éƒ¨é€šè¿‡ï¼**
  - æµ‹è¯• 1-4ï¼šæ•°æ®åº“åˆ›å»ºã€è¡¨å‡†å¤‡ã€ç”¨æˆ·åˆ›å»ºã€PasswordService åˆ›å»º âœ…
  - æµ‹è¯• 5ï¼šå¯†ç è®¾ç½®å’ŒéªŒè¯ âœ…
  - æµ‹è¯• 6ï¼šå¯†ç å¼ºåº¦æ£€æŸ¥ âœ…
  - æµ‹è¯• 7-9ï¼šAuthTokenService åˆ›å»ºã€åŸŸæ³¨å†Œã€ä»¤ç‰Œåˆ›å»º âœ…
  - æµ‹è¯• 10ï¼šä»¤ç‰ŒéªŒè¯ âœ…
  - æµ‹è¯• 11ï¼šè®¿é—®ç”¨æˆ·çš„æ‰€æœ‰ä»¤ç‰Œ âœ…
  - æµ‹è¯• 12ï¼šç™»å½•é™æµ âœ…
  - æµ‹è¯• 13ï¼šæ¸…é™¤ç”¨æˆ·ä»¤ç‰Œ âœ…

**ä¿®å¤çš„é—®é¢˜**ï¼š
1. âœ… ä¿®å¤äº† `Session::create` ç¼ºå°‘ `flush()` çš„é—®é¢˜
2. âœ… ä¿®å¤äº† `AuthToken::find` ä¸­ `checkReadTransaction()` åœ¨å†™äº‹åŠ¡ä¸­è°ƒç”¨çš„é—®é¢˜
3. âœ… ä¿®å¤äº† `createAuthToken` ä¸­äº‹åŠ¡æœªæ˜¾å¼æäº¤çš„é—®é¢˜
4. âœ… ä¿®å¤äº† `clearUserTokens` å’Œ `removeExpiredTokens` ä¸­ DELETE æŸ¥è¯¢çš„æ‰§è¡Œæ–¹å¼

**å½“å‰çŠ¶æ€**ï¼š
- é˜¶æ®µ 4ï¼šæœåŠ¡å±‚ - Auth Service â€” **100% å®Œæˆ** âœ…
- æ‰€æœ‰ä»£ç ç¼–è¯‘é€šè¿‡
- æ‰€æœ‰æµ‹è¯•é€šè¿‡ï¼ˆ13 ä¸ªæµ‹è¯•ç”¨ä¾‹å…¨éƒ¨é€šè¿‡ï¼‰

---

## é˜¶æ®µ 5ï¼šæœåŠ¡å±‚ - Scanner Serviceï¼ˆå¼€å§‹ ğŸš§ï¼‰

**å¼€å§‹æ—¶é—´**ï¼š2025-11-22

### 5.1 Scanner Service åŸºç¡€æ¶æ„ï¼ˆå¾…å¼€å§‹ï¼‰

**è®¾è®¡æ€è·¯**ï¼ˆå‚è€ƒæ¨¡æ¿ï¼‰ï¼š
- å®ç°éŸ³ä¹æ–‡ä»¶æ‰«ææœåŠ¡ï¼ˆScanner Serviceï¼‰
- æ‰«æåª’ä½“åº“ç›®å½•ï¼Œå‘ç°éŸ³ä¹æ–‡ä»¶
- æå–éŸ³é¢‘æ–‡ä»¶çš„å…ƒæ•°æ®ï¼ˆæ ‡ç­¾ä¿¡æ¯ï¼‰
- æ”¯æŒå¤šç§éŸ³é¢‘æ ¼å¼ï¼ˆMP3, FLAC, OGG, M4A ç­‰ï¼‰
- æ”¯æŒå¢é‡æ‰«æå’Œå…¨é‡æ‰«æ
- æ‰«æè¿›åº¦æŠ¥å‘Šå’Œäº‹ä»¶é€šçŸ¥

**å®ç°è®¡åˆ’**ï¼š
1. åˆ›å»º Scanner Service ç›®å½•ç»“æ„
2. å®ç° IScannerService æ¥å£
3. å®ç°æ–‡ä»¶æ‰«æå™¨ï¼ˆFileScannerï¼‰
4. å®ç°å…ƒæ•°æ®æå–å™¨ï¼ˆMetadataExtractorï¼‰
5. å®ç°æ‰«ææ­¥éª¤ï¼ˆScan Stepsï¼‰
6. å®ç°æ‰«ææœåŠ¡ä¸»ç±»ï¼ˆScannerServiceï¼‰

**å®ç°å†…å®¹**ï¼š
- âœ… åˆ›å»º Scanner Service ç›®å½•ç»“æ„
- âœ… å®ç°åŸºç¡€ç±»å‹å®šä¹‰ï¼š
  - `ScanErrors.hpp`ï¼šæ‰«æé”™è¯¯ç±»å‹ï¼ˆç®€åŒ–ç‰ˆï¼‰
  - `ScannerOptions.hpp`ï¼šæ‰«æé€‰é¡¹
  - `ScannerStats.hpp`ï¼šæ‰«æç»Ÿè®¡ä¿¡æ¯ï¼ˆScanStats, ScanStepStatsï¼‰
  - `ScannerEvents.hpp`ï¼šæ‰«æäº‹ä»¶ï¼ˆEventsï¼‰
- âœ… å®ç° `IScannerService` æ¥å£
- âœ… å®ç° `ScannerService` ç±»ï¼ˆç®€åŒ–ç‰ˆï¼ŒåŸºç¡€æ¡†æ¶ï¼‰
- âœ… æ·»åŠ  SCANNER æ¨¡å—åˆ°æ—¥å¿—ç³»ç»Ÿ

**æ–‡ä»¶**ï¼š
- `src/libs/services/scanner/include/services/scanner/IScannerService.hpp`
- `src/libs/services/scanner/include/services/scanner/ScannerEvents.hpp`
- `src/libs/services/scanner/include/services/scanner/ScannerOptions.hpp`
- `src/libs/services/scanner/include/services/scanner/ScannerStats.hpp`
- `src/libs/services/scanner/include/services/scanner/ScanErrors.hpp`
- `src/libs/services/scanner/impl/ScannerService.hpp/cpp`
- `src/libs/services/scanner/CMakeLists.txt`

**å½“å‰è¿›åº¦**ï¼š20% å®Œæˆï¼ˆåŸºç¡€æ¶æ„å·²æ­å»ºï¼‰

**æœ€æ–°è¿›å±•**ï¼ˆ2025-11-22 ç»§ç»­å®ç°ï¼‰ï¼š
- âœ… å®ç°äº†æ–‡ä»¶æ‰«æå™¨åŸºç¡€æ¶æ„ï¼š
  - `IFileScanner` æ¥å£
  - `IFileScanOperation` æ¥å£
  - `FileScanOperationBase` åŸºç±»
  - `FileToScan` ç»“æ„
  - `MediaLibraryInfo` ç»“æ„
- âœ… å®ç°äº†æ‰«ææ­¥éª¤åŸºç¡€æ¶æ„ï¼š
  - `ScanStepBase` åŸºç±»
  - `ScanStepScanFiles` æ‰«ææ–‡ä»¶æ­¥éª¤ï¼ˆç®€åŒ–ç‰ˆï¼‰
- âœ… é›†æˆæ‰«ææ­¥éª¤åˆ° `ScannerService`

**æ–‡ä»¶**ï¼š
- `src/libs/services/scanner/impl/MediaLibraryInfo.hpp`
- `src/libs/services/scanner/impl/scanners/FileToScan.hpp`
- `src/libs/services/scanner/impl/scanners/IFileScanOperation.hpp`
- `src/libs/services/scanner/impl/scanners/IFileScanner.hpp`
- `src/libs/services/scanner/impl/scanners/FileScanOperationBase.hpp/cpp`
- `src/libs/services/scanner/impl/steps/ScanStepBase.hpp/cpp`
- `src/libs/services/scanner/impl/steps/ScanStepScanFiles.hpp/cpp`

**æœ€æ–°è¿›å±•**ï¼ˆ2025-11-22 ç»§ç»­å®ç°ï¼‰ï¼š
- âœ… å®ç°äº†ç›®å½•éå†å’Œæ–‡ä»¶å‘ç°åŠŸèƒ½ï¼š
  - `Utils::discoverFiles`ï¼šé€’å½’éå†ç›®å½•ï¼Œå‘ç°éŸ³é¢‘æ–‡ä»¶
  - `Utils::hasSupportedExtension`ï¼šæ£€æŸ¥æ–‡ä»¶æ‰©å±•åæ˜¯å¦æ”¯æŒ
- âœ… å®ç°äº†éŸ³é¢‘æ–‡ä»¶æ‰«æå™¨ï¼ˆAudioFileScannerï¼‰ï¼š
  - æ”¯æŒå¸¸è§éŸ³é¢‘æ ¼å¼ï¼šMP3, FLAC, OGG, M4A, AAC, WAV, WMA, OPUS, MPC, APE
  - å®ç°äº† `IFileScanner` æ¥å£
- âœ… åœ¨ `ScanStepScanFiles` ä¸­é›†æˆäº†æ–‡ä»¶å‘ç°é€»è¾‘ï¼š
  - ä»é…ç½®è¯»å–åª’ä½“åº“è·¯å¾„
  - ä½¿ç”¨ `AudioFileScanner` è·å–æ”¯æŒçš„æ‰©å±•å
  - ä½¿ç”¨ `Utils::discoverFiles` å‘ç°æ–‡ä»¶
  - æ›´æ–°æ‰«æç»Ÿè®¡ä¿¡æ¯

**æ–‡ä»¶**ï¼š
- `src/libs/services/scanner/impl/scanners/Utils.hpp/cpp`
- `src/libs/services/scanner/impl/scanners/audiofile/AudioFileScanner.hpp/cpp`

**æœ€æ–°è¿›å±•**ï¼ˆ2025-11-22 ç»§ç»­å®ç°ï¼‰ï¼š
- âœ… å®ç°äº† AudioFileScanOperationï¼ˆç®€åŒ–ç‰ˆï¼‰ï¼š
  - å®ç°äº† `IFileScanOperation` æ¥å£
  - å®ç°äº† `scan()` æ–¹æ³•ï¼ˆç®€åŒ–ç‰ˆï¼šåªæ£€æŸ¥æ–‡ä»¶æ˜¯å¦å­˜åœ¨ï¼‰
  - å®ç°äº† `processResult()` æ–¹æ³•ï¼ˆç®€åŒ–ç‰ˆï¼šæš‚æ—¶è¿”å› Skippedï¼‰
  - é›†æˆäº†é”™è¯¯å¤„ç†æœºåˆ¶
- âœ… æ›´æ–°äº† AudioFileScanner ä»¥åˆ›å»º AudioFileScanOperation å®ä¾‹

**æ–‡ä»¶**ï¼š
- `src/libs/services/scanner/impl/scanners/audiofile/AudioFileScanOperation.hpp/cpp`

**æœ€æ–°è¿›å±•**ï¼ˆ2025-11-22 ç»§ç»­å®ç°æ•°æ®åº“å¯¹è±¡ï¼‰ï¼š
- âœ… å®ç°äº†æ•°æ®åº“ ID ç±»å‹ï¼š
  - `TrackId`, `ArtistId`, `ReleaseId`, `MediumId`, `MediaLibraryId`, `DirectoryId`
- âœ… å®ç°äº† Artist æ•°æ®åº“å¯¹è±¡ï¼ˆç®€åŒ–ç‰ˆï¼‰ï¼š
  - åŸºæœ¬å­—æ®µï¼šname, sortName
  - é™æ€æ–¹æ³•ï¼šgetCount, find, getOrCreate, create
  - è®¿é—®å™¨ï¼šgetName, setName, getSortName, setSortName
  - é›†æˆåˆ° Session æ˜ å°„

**æ–‡ä»¶**ï¼š
- `src/libs/database/include/database/objects/TrackId.hpp`
- `src/libs/database/include/database/objects/ArtistId.hpp`
- `src/libs/database/include/database/objects/ReleaseId.hpp`
- `src/libs/database/include/database/objects/MediumId.hpp`
- `src/libs/database/include/database/objects/MediaLibraryId.hpp`
- `src/libs/database/include/database/objects/DirectoryId.hpp`
- `src/libs/database/include/database/objects/Artist.hpp`
- `src/libs/database/impl/objects/Artist.cpp`

**æœ€æ–°è¿›å±•**ï¼ˆ2025-11-22 ç»§ç»­å®ç°æ•°æ®åº“å¯¹è±¡ï¼‰ï¼š
- âœ… å®ç°äº† Track æ•°æ®åº“å¯¹è±¡ï¼ˆç®€åŒ–ç‰ˆï¼‰ï¼š
  - åŸºæœ¬å­—æ®µï¼šname, absoluteFilePath, fileSize, fileLastWrite, duration, trackNumber
  - å…³è”ï¼šRelease, Medium
  - é™æ€æ–¹æ³•ï¼šgetCount, find, findByPath, getOrCreate, create
  - è®¿é—®å™¨ï¼šgetName, setName, getAbsoluteFilePath, setAbsoluteFilePath, getDuration, setDuration ç­‰
- âœ… å®ç°äº† Release æ•°æ®åº“å¯¹è±¡ï¼ˆç®€åŒ–ç‰ˆï¼‰ï¼š
  - åŸºæœ¬å­—æ®µï¼šname, sortName
  - é™æ€æ–¹æ³•ï¼šgetCount, find, getOrCreate, create
- âœ… å®ç°äº† Medium æ•°æ®åº“å¯¹è±¡ï¼ˆç®€åŒ–ç‰ˆï¼‰ï¼š
  - åŸºæœ¬å­—æ®µï¼šname, position
  - å…³è”ï¼šRelease
  - é™æ€æ–¹æ³•ï¼šgetCount, find, getOrCreate, create
- âœ… æ‰€æœ‰å¯¹è±¡å·²é›†æˆåˆ° Session æ˜ å°„

**æ–‡ä»¶**ï¼š
- `src/libs/database/include/database/objects/Track.hpp/cpp`
- `src/libs/database/include/database/objects/Release.hpp/cpp`
- `src/libs/database/include/database/objects/Medium.hpp/cpp`

**å½“å‰è¿›åº¦**ï¼š85% å®Œæˆï¼ˆæ ¸å¿ƒæ•°æ®åº“å¯¹è±¡å·²å®ç°ï¼‰

**æ³¨æ„**ï¼š
- Track å¯¹è±¡ä½¿ç”¨ `std::string` å­˜å‚¨æ–‡ä»¶è·¯å¾„ï¼ˆWt::Dbo ä¸æ”¯æŒ `std::filesystem::path`ï¼‰
- Track å¯¹è±¡ä½¿ç”¨ `long long` å­˜å‚¨æ—¶é•¿ï¼ˆæ¯«ç§’æ•°ï¼ŒWt::Dbo ä¸æ”¯æŒ `std::chrono::milliseconds`ï¼‰
- æ‰€æœ‰å¯¹è±¡éƒ½æ˜¯ç®€åŒ–ç‰ˆæœ¬ï¼ŒåŒ…å«æ ¸å¿ƒå­—æ®µå’ŒåŸºæœ¬åŠŸèƒ½

**ä¸‹ä¸€æ­¥**ï¼š
- å®ç° Directory å’Œ MediaLibrary å¯¹è±¡
- å®Œå–„ AudioFileScanOperation ä»¥ä½¿ç”¨è¿™äº›æ•°æ®åº“å¯¹è±¡
- å®ç°å®é™…çš„æ•°æ®åº“æ›´æ–°é€»è¾‘

---

## æµ‹è¯•è¿›å±•ï¼ˆ2025-11-22ï¼‰

### æ•°æ®åº“ç³»ç»Ÿæµ‹è¯•ç¨‹åºåˆ›å»º âœ…

åˆ›å»ºäº†å®Œæ•´çš„æµ‹è¯•ç¨‹åº `test_database.cpp`ï¼Œæµ‹è¯•å†…å®¹åŒ…æ‹¬ï¼š
- æ•°æ®åº“åˆ›å»ºå’Œè¿æ¥
- è¡¨ç»“æ„å‡†å¤‡
- æ•°æ®åº“è¿ç§»ç³»ç»Ÿ
- User æ•°æ®å¯¹è±¡çš„ CRUD æ“ä½œ
- äº‹åŠ¡ç®¡ç†

**æµ‹è¯•ç»“æœ**ï¼š
- âœ… æ•°æ®åº“åˆ›å»ºæˆåŠŸ
- âœ… è¡¨ç»“æ„å‡†å¤‡æˆåŠŸ
- âœ… è¿ç§»ç³»ç»ŸåŸºæœ¬åŠŸèƒ½æ­£å¸¸
- âš ï¸  VersionInfo è¡¨åˆ›å»ºæ—¶æœºéœ€è¦ä¼˜åŒ–ï¼ˆåœ¨äº‹åŠ¡å¤–åˆ›å»ºè¡¨ï¼Œåœ¨äº‹åŠ¡å†…è¿ç§»ï¼‰

**å‘ç°çš„é—®é¢˜**ï¼š
1. `createTables()` éœ€è¦åœ¨äº‹åŠ¡å¤–æ‰§è¡Œ
2. è¿ç§»éœ€è¦åœ¨äº‹åŠ¡å†…æ‰§è¡Œ
3. éœ€è¦ç¡®ä¿ VersionInfo è¡¨åœ¨è¿ç§»å‰å·²åˆ›å»º

**å½“å‰çŠ¶æ€**ï¼šæµ‹è¯•ç¨‹åºå·²åˆ›å»ºï¼Œå¤§éƒ¨åˆ†åŠŸèƒ½æ­£å¸¸ï¼Œéœ€è¦ä¼˜åŒ–è¿ç§»æµç¨‹

---

## Git æäº¤è®°å½•ï¼ˆ2025-11-22ï¼‰

### Commit: cee192a - feat: å®ç°æ•°æ®åº“è¿ç§»ç³»ç»Ÿå’Œæµ‹è¯•ç¨‹åº

**æäº¤å†…å®¹**ï¼š
- å®ç°æ•°æ®åº“è¿ç§»ç³»ç»Ÿï¼ˆVersionInfoã€Migrationå‘½åç©ºé—´ï¼‰
- å®ç°Useræ•°æ®å¯¹è±¡ï¼ˆç®€åŒ–ç‰ˆï¼ŒåŒ…å«åŸºæœ¬CRUDæ“ä½œï¼‰
- åˆ›å»ºæ•°æ®åº“æµ‹è¯•ç¨‹åºï¼ˆtest_database.cppï¼‰
- ä¿®å¤Object::getId()æ–¹æ³•æ„é€ é—®é¢˜
- ä¼˜åŒ–Sessionå’ŒTransactionå®ç°
- æ›´æ–°å¼€å‘æ—¥å¿—å’Œè¿›åº¦è·Ÿè¸ª

**å®Œæˆé˜¶æ®µ**ï¼šé˜¶æ®µ 3 - æ•°æ®åº“åŸºç¡€åŠŸèƒ½ âœ…

**ç»Ÿè®¡**ï¼š
- 54 ä¸ªæ–‡ä»¶ä¿®æ”¹
- 6114 è¡Œæ–°å¢
- 5844 è¡Œåˆ é™¤
- 1 ä¸ªæ–°æ–‡ä»¶ï¼ˆtest_database.cppï¼‰

**ç›¸å…³æ¨¡å—**ï¼šdatabase, core

