# Lightweight Music Server (LMS)

**LMS** 是一款功能强大的自托管音乐流媒体服务器，通过现代化的 Web 界面访问和管理音乐收藏。支持多种音频格式，提供完整的音乐库管理、播放队列、实时转码、播客订阅和智能推荐等功能。

**LMS** — это мощный самодостаточный музыкальный стриминговый сервер с современным веб-интерфейсом для доступа и управления музыкальной коллекцией. Поддерживает множество аудиоформатов, предоставляет полное управление музыкальной библиотекой, очередь воспроизведения, транскодирование в реальном времени, подписки на подкасты и интеллектуальные рекомендации.

---

## 📋 目录 / Содержание

- [主要特性](#主要特性)
- [技术栈](#技术栈)
- [系统架构](#系统架构)
- [模块详解](#模块详解)
- [环境要求](#环境要求)
- [构建与安装](#构建与安装)
- [配置说明](#配置说明)
- [运行与使用](#运行与使用)
- [API 支持](#api-支持)
- [开发指南](#开发指南)

---

## ✨ 主要特性 / Основные возможности

### 🎵 音乐库管理 / Управление музыкальной библиотекой
- **自动扫描**：自动扫描指定目录中的音乐文件，提取元数据（艺术家、专辑、曲目信息等）
- **元数据提取**：支持从音频文件标签（ID3、Vorbis Comments 等）提取完整元数据
- **封面管理**：自动提取和缓存专辑封面，支持多种尺寸
- **智能分类**：基于聚类算法自动分类音乐（流派、年份、国家等）

- **Автоматическое сканирование**: автоматически сканирует музыкальные файлы в указанных каталогах, извлекает метаданные (исполнитель, альбом, информация о треке и т.д.)
- **Извлечение метаданных**: поддерживает извлечение полных метаданных из тегов аудиофайлов (ID3, Vorbis Comments и т.д.)
- **Управление обложками**: автоматически извлекает и кэширует обложки альбомов, поддерживает различные размеры
- **Интеллектуальная классификация**: автоматически классифицирует музыку на основе алгоритмов кластеризации (жанр, год, страна и т.д.)

### 🎨 Web 界面 / Веб-интерфейс
- **现代化设计**：基于 Bootstrap 5 的响应式界面，支持移动设备
- **多语言支持**：内置多语言支持（中文、英文、法文、意大利文、波兰文、西班牙文等）
- **实时更新**：使用服务器推送技术实现实时界面更新
- **无限滚动**：支持大量数据的懒加载和无限滚动
- **播放队列**：强大的播放队列管理，支持随机播放、重复播放、电台模式

- **Современный дизайн**: адаптивный интерфейс на базе Bootstrap 5, поддерживает мобильные устройства
- **Многоязычная поддержка**: встроенная поддержка нескольких языков (китайский, английский, французский, итальянский, польский, испанский и т.д.)
- **Обновления в реальном времени**: использует технологию серверных push-обновлений для обновления интерфейса в реальном времени
- **Бесконечная прокрутка**: поддерживает ленивую загрузку и бесконечную прокрутку для больших объёмов данных
- **Очередь воспроизведения**: мощное управление очередью воспроизведения, поддерживает случайное воспроизведение, повтор, режим радио

### 🔐 用户认证 / Аутентификация пользователей
- **多种认证方式**：
  - **内部认证**：内置用户名/密码认证系统
  - **PAM 认证**：集成系统 PAM（Pluggable Authentication Modules）
  - **HTTP Headers 认证**：支持反向代理注入的认证头（适用于 SSO）
- **会话管理**：支持"记住我"功能，可配置会话持续时间
- **登录限流**：防止暴力破解攻击的登录限流机制
- **用户类型**：支持管理员、普通用户和演示用户

- **Множественные способы аутентификации**:
  - **Внутренняя аутентификация**: встроенная система аутентификации по имени пользователя/паролю
  - **PAM-аутентификация**: интеграция с системным PAM (Pluggable Authentication Modules)
  - **Аутентификация HTTP Headers**: поддержка заголовков аутентификации, внедрённых обратным прокси (подходит для SSO)
- **Управление сессиями**: поддержка функции "запомнить меня", настраиваемая длительность сессии
- **Ограничение входа**: механизм ограничения входа для защиты от атак перебора
- **Типы пользователей**: поддержка администратора, обычного пользователя и демо-пользователя

### 🎧 音频转码 / Транскодирование аудио
- **实时转码**：支持多种音频格式的实时转码（OGG Opus、MP3、AAC 等）
- **智能转码**：可配置何时转码（从不、总是、格式不支持时）
- **可配置比特率**：支持自定义转码比特率
- **ReplayGain 支持**：自动音量标准化，支持曲目级别和专辑级别

- **Транскодирование в реальном времени**: поддерживает транскодирование в реальном времени в различные аудиоформаты (OGG Opus, MP3, AAC и т.д.)
- **Интеллектуальное транскодирование**: настраиваемое, когда транскодировать (никогда, всегда, когда формат не поддерживается)
- **Настраиваемый битрейт**: поддержка пользовательского битрейта транскодирования
- **Поддержка ReplayGain**: автоматическая нормализация громкости, поддержка уровня трека и альбома

### 📻 播客支持 / Поддержка подкастов
- **订阅管理**：支持 RSS 播客订阅
- **自动更新**：定期自动更新播客内容
- **剧集下载**：自动下载播客剧集
- **封面提取**：自动提取播客和剧集封面

- **Управление подписками**: поддержка подписок на RSS-подкасты
- **Автоматическое обновление**: периодическое автоматическое обновление контента подкастов
- **Загрузка эпизодов**: автоматическая загрузка эпизодов подкастов
- **Извлечение обложек**: автоматическое извлечение обложек подкастов и эпизодов

### 🎯 智能推荐 / Интеллектуальные рекомендации
- **基于聚类的推荐**：使用聚类算法推荐相似音乐
- **基于特征的推荐**：基于音频特征（BPM、调性等）推荐
- **播放列表生成**：自动生成智能播放列表
- **电台模式**：自动添加推荐曲目到播放队列

- **Рекомендации на основе кластеров**: использует алгоритмы кластеризации для рекомендации похожей музыки
- **Рекомендации на основе признаков**: рекомендации на основе аудиопризнаков (BPM, тональность и т.д.)
- **Генерация плейлистов**: автоматическая генерация интеллектуальных плейлистов
- **Режим радио**: автоматическое добавление рекомендуемых треков в очередь воспроизведения

### 🔍 Subsonic API / Subsonic API
- **完全兼容**：完全兼容 Subsonic API 协议
- **多客户端支持**：支持所有基于 Subsonic API 的音乐客户端
- **认证支持**：支持 Token 和密码认证

- **Полная совместимость**: полностью совместим с протоколом Subsonic API
- **Поддержка множественных клиентов**: поддерживает все музыкальные клиенты на базе Subsonic API
- **Поддержка аутентификации**: поддержка аутентификации по токену и паролю

---

## 🛠 技术栈 / Технологический стек

### 核心语言与框架 / Основные языки и фреймворки
- **编程语言**：C++20
- **Web 框架**：Wt 4.12.1+ (Wt::Dbo ORM)
- **数据库**：SQLite3
- **配置解析**：libconfig++
- **构建系统**：CMake 3.20+

- **Язык программирования**: C++20
- **Веб-фреймворк**: Wt 4.12.1+ (Wt::Dbo ORM)
- **База данных**: SQLite3
- **Парсинг конфигурации**: libconfig++
- **Система сборки**: CMake 3.20+

### 主要依赖 / Основные зависимости
- **音频处理**：TagLib、FFmpeg
- **图像处理**：GraphicsMagick、stb_image
- **网络**：Boost.Asio、OpenSSL
- **其他**：Boost 库集合

- **Обработка аудио**: TagLib, FFmpeg
- **Обработка изображений**: GraphicsMagick, stb_image
- **Сеть**: Boost.Asio, OpenSSL
- **Прочее**: набор библиотек Boost

---

## 🏗 系统架构 / Архитектура системы

LMS 采用模块化架构，主要分为以下几个层次：

LMS использует модульную архитектуру, в основном разделённую на следующие уровни:

```
┌─────────────────────────────────────────────────────────┐
│                    Web 界面层 (UI)                       │
│              (LmsApplication, Views, Resources)         │
└─────────────────────────────────────────────────────────┘
                            ↓
┌─────────────────────────────────────────────────────────┐
│                    服务层 (Services)                     │
│  (Scanner, Auth, Transcoding, Podcast, Recommendation)  │
└─────────────────────────────────────────────────────────┘
                            ↓
┌─────────────────────────────────────────────────────────┐
│                   业务逻辑层 (Libraries)                  │
│        (Audio, Image, Database, Core Utilities)         │
└─────────────────────────────────────────────────────────┘
                            ↓
┌─────────────────────────────────────────────────────────┐
│                   数据持久层 (Database)                   │
│                    (SQLite3 + Wt::Dbo)                   │
└─────────────────────────────────────────────────────────┘
```

---

## 📦 模块详解 / Подробное описание модулей

### 1. 核心库 (core) / Основная библиотека (core)

**位置**：`src/libs/core/`  
**功能**：提供系统基础功能和工具类

**Расположение**: `src/libs/core/`  
**Функции**: предоставляет базовую функциональность системы и утилитные классы

#### 主要组件 / Основные компоненты

- **配置管理 (Config)**：读取和管理配置文件（libconfig++）
- **日志系统 (Logger)**：多级别日志记录（DEBUG、INFO、WARNING、ERROR、FATAL）
- **路径处理 (Path)**：跨平台路径操作和规范化
- **字符串工具 (String)**：字符串转换、解析和格式化
- **随机数生成 (Random)**：安全的随机数生成
- **UUID 生成 (UUID)**：唯一标识符生成
- **HTTP 客户端 (http/Client)**：异步 HTTP 客户端
- **子进程管理 (ChildProcessManager)**：管理外部进程（如 FFmpeg）
- **任务调度器 (JobScheduler)**：后台任务调度
- **追踪日志 (TraceLogger)**：性能追踪和调试
- **IO 上下文运行器 (IOContextRunner)**：Boost.Asio IO 上下文管理

- **Управление конфигурацией (Config)**: чтение и управление файлами конфигурации (libconfig++)
- **Система логирования (Logger)**: многоуровневое логирование (DEBUG, INFO, WARNING, ERROR, FATAL)
- **Обработка путей (Path)**: кроссплатформенные операции с путями и нормализация
- **Утилиты строк (String)**: преобразование, парсинг и форматирование строк
- **Генерация случайных чисел (Random)**: безопасная генерация случайных чисел
- **Генерация UUID (UUID)**: генерация уникальных идентификаторов
- **HTTP-клиент (http/Client)**: асинхронный HTTP-клиент
- **Управление дочерними процессами (ChildProcessManager)**: управление внешними процессами (например, FFmpeg)
- **Планировщик задач (JobScheduler)**: планирование фоновых задач
- **Трассировочное логирование (TraceLogger)**: трассировка производительности и отладка
- **Запуск IO-контекста (IOContextRunner)**: управление IO-контекстом Boost.Asio

---

### 2. 数据库层 (database) / Слой базы данных (database)

**位置**：`src/libs/database/`  
**功能**：提供数据库抽象层和 ORM 功能

**Расположение**: `src/libs/database/`  
**Функции**: предоставляет слой абстракции БД и функциональность ORM

#### 主要组件 / Основные компоненты

- **数据库接口 (IDb)**：数据库连接池管理
- **会话管理 (Session)**：线程安全的数据库会话（使用 TLS）
- **ORM 对象 (Object)**：基于 Wt::Dbo 的对象关系映射
- **事务管理 (Transaction)**：数据库事务处理
- **迁移系统 (Migration)**：数据库架构版本管理和自动迁移
- **查询计划记录器 (QueryPlanRecorder)**：SQL 查询性能分析
- **数据对象 (objects/)**：
  - `Artist`：艺术家信息
  - `Release`：专辑信息
  - `Track`：曲目信息
  - `TrackList`：播放列表
  - `User`：用户信息
  - `Cluster`：聚类标签（流派、年份等）
  - `MediaLibrary`：媒体库配置
  - 等等...

- **Интерфейс БД (IDb)**: управление пулом соединений БД
- **Управление сессиями (Session)**: потокобезопасные сессии БД (с использованием TLS)
- **ORM-объекты (Object)**: объектно-реляционное отображение на базе Wt::Dbo
- **Управление транзакциями (Transaction)**: обработка транзакций БД
- **Система миграций (Migration)**: управление версиями схемы БД и автоматические миграции
- **Регистратор планов запросов (QueryPlanRecorder)**: анализ производительности SQL-запросов
- **Объекты данных (objects/)**:
  - `Artist`: информация об исполнителе
  - `Release`: информация об альбоме
  - `Track`: информация о треке
  - `TrackList`: плейлист
  - `User`: информация о пользователе
  - `Cluster`: метки кластеров (жанр, год и т.д.)
  - `MediaLibrary`: конфигурация медиатеки
  - и т.д.

---

### 3. 音频处理库 (audio) / Библиотека обработки аудио (audio)

**位置**：`src/libs/audio/`  
**功能**：音频文件元数据提取和转码

**Расположение**: `src/libs/audio/`  
**Функции**: извлечение метаданных аудиофайлов и транскодирование

#### 主要组件 / Основные компоненты

- **音频文件信息 (IAudioFileInfo)**：提取音频文件的基本信息（时长、比特率、采样率等）
- **标签读取器 (ITagReader)**：
  - **TagLib 实现**：使用 TagLib 库读取 ID3、Vorbis Comments 等标签
  - **FFmpeg 实现**：使用 FFmpeg 作为后备方案
- **图像读取器 (IImageReader)**：从音频文件中提取嵌入的封面图片
- **转码器 (ITranscoder)**：使用 FFmpeg 进行音频格式转换
- **音频类型 (AudioTypes)**：音频格式和编码定义

- **Информация об аудиофайле (IAudioFileInfo)**: извлечение основной информации об аудиофайле (длительность, битрейт, частота дискретизации и т.д.)
- **Читатель тегов (ITagReader)**:
  - **Реализация TagLib**: использует библиотеку TagLib для чтения тегов ID3, Vorbis Comments и т.д.
  - **Реализация FFmpeg**: использует FFmpeg в качестве резервного варианта
- **Читатель изображений (IImageReader)**: извлечение встроенных обложек из аудиофайлов
- **Транскодер (ITranscoder)**: преобразование форматов аудио с использованием FFmpeg
- **Типы аудио (AudioTypes)**: определения форматов и кодировок аудио

---

### 4. 图像处理库 (image) / Библиотека обработки изображений (image)

**位置**：`src/libs/image/`  
**功能**：图像处理和编码

**Расположение**: `src/libs/image/`  
**Функции**: обработка и кодирование изображений

#### 主要组件 / Основные компоненты

- **编码图像 (EncodedImage)**：图像编码和格式转换
- **GraphicsMagick 支持**：使用 GraphicsMagick 进行图像处理
- **stb_image 支持**：轻量级图像加载库（后备方案）
- **图像缓存**：自动缓存处理后的图像以提高性能

- **Закодированное изображение (EncodedImage)**: кодирование изображений и преобразование форматов
- **Поддержка GraphicsMagick**: обработка изображений с использованием GraphicsMagick
- **Поддержка stb_image**: лёгкая библиотека загрузки изображений (резервный вариант)
- **Кэш изображений**: автоматическое кэширование обработанных изображений для повышения производительности

---

### 5. 服务层 (services) / Слой сервисов (services)

#### 5.1 扫描服务 (scanner) / Сервис сканирования (scanner)

**位置**：`src/libs/services/scanner/`  
**功能**：扫描音乐文件并提取元数据

**Расположение**: `src/libs/services/scanner/`  
**Функции**: сканирование музыкальных файлов и извлечение метаданных

**工作流程**：
1. **文件发现**：递归扫描配置的媒体库目录
2. **文件分析**：使用音频库提取元数据和封面
3. **数据库更新**：将提取的信息存储到数据库
4. **聚类分析**：自动生成聚类标签（流派、年份等）
5. **增量更新**：只处理新增或修改的文件

**Рабочий процесс**:
1. **Обнаружение файлов**: рекурсивное сканирование настроенных каталогов медиатек
2. **Анализ файлов**: использование аудиобиблиотеки для извлечения метаданных и обложек
3. **Обновление БД**: сохранение извлечённой информации в БД
4. **Кластерный анализ**: автоматическая генерация меток кластеров (жанр, год и т.д.)
5. **Инкрементальное обновление**: обработка только новых или изменённых файлов

#### 5.2 认证服务 (auth) / Сервис аутентификации (auth)

**位置**：`src/libs/services/auth/`  
**功能**：用户认证和授权

**Расположение**: `src/libs/services/auth/`  
**Функции**: аутентификация и авторизация пользователей

**组件**：
- **密码服务 (IPasswordService)**：
  - 内部认证：内置用户名/密码系统
  - PAM 认证：系统 PAM 集成
- **Token 服务 (IAuthTokenService)**：管理"记住我"认证令牌
- **环境服务 (IEnvService)**：HTTP Headers 认证（用于反向代理）
- **登录限流器 (LoginThrottler)**：防止暴力破解攻击

**Компоненты**:
- **Сервис паролей (IPasswordService)**:
  - Внутренняя аутентификация: встроенная система имени пользователя/пароля
  - PAM-аутентификация: интеграция с системным PAM
- **Сервис токенов (IAuthTokenService)**: управление токенами аутентификации "запомнить меня"
- **Сервис окружения (IEnvService)**: аутентификация HTTP Headers (для обратного прокси)
- **Ограничитель входа (LoginThrottler)**: защита от атак перебора

#### 5.3 转码服务 (transcoding) / Сервис транскодирования (transcoding)

**位置**：`src/libs/services/transcoding/`  
**功能**：音频文件实时转码

**Расположение**: `src/libs/services/transcoding/`  
**Функции**: транскодирование аудиофайлов в реальном времени

**特性**：
- 支持多种输出格式（OGG Opus、MP3、AAC 等）
- 可配置的比特率
- 流式传输（分块传输，不占用大量内存）
- 使用 FFmpeg 作为转码引擎

**Особенности**:
- Поддержка множественных форматов вывода (OGG Opus, MP3, AAC и т.д.)
- Настраиваемый битрейт
- Потоковая передача (передача по частям, не занимает много памяти)
- Использование FFmpeg в качестве движка транскодирования

#### 5.4 播客服务 (podcast) / Сервис подкастов (podcast)

**位置**：`src/libs/services/podcast/`  
**功能**：播客订阅和管理

**Расположение**: `src/libs/services/podcast/`  
**Функции**: подписки на подкасты и управление

**功能**：
- RSS 订阅解析
- 自动定期更新播客内容
- 剧集下载和管理
- 封面提取和缓存

**Функции**:
- Парсинг RSS-подписок
- Автоматическое периодическое обновление контента подкастов
- Загрузка и управление эпизодами
- Извлечение и кэширование обложек

#### 5.5 推荐服务 (recommendation) / Сервис рекомендаций (recommendation)

**位置**：`src/libs/services/recommendation/`  
**功能**：智能音乐推荐

**Расположение**: `src/libs/services/recommendation/`  
**Функции**: интеллектуальные музыкальные рекомендации

**算法**：
- **聚类引擎 (ClustersEngine)**：基于聚类标签推荐相似音乐
- **特征引擎 (FeaturesEngine)**：基于音频特征（BPM、调性等）推荐
- **播放列表生成器 (PlaylistGeneratorService)**：生成智能播放列表

**Алгоритмы**:
- **Движок кластеров (ClustersEngine)**: рекомендации похожей музыки на основе меток кластеров
- **Движок признаков (FeaturesEngine)**: рекомендации на основе аудиопризнаков (BPM, тональность и т.д.)
- **Генератор плейлистов (PlaylistGeneratorService)**: генерация интеллектуальных плейлистов

#### 5.6 封面服务 (artwork) / Сервис обложек (artwork)

**位置**：`src/libs/services/artwork/`  
**功能**：封面图片管理和缓存

**Расположение**: `src/libs/services/artwork/`  
**Функции**: управление изображениями обложек и кэширование

**功能**：
- 从音频文件提取封面
- 封面图片缓存（多种尺寸）
- 默认封面管理（艺术家、专辑、曲目）

**Функции**:
- Извлечение обложек из аудиофайлов
- Кэширование изображений обложек (различные размеры)
- Управление обложками по умолчанию (исполнитель, альбом, трек)

#### 5.7 Scrobbling 服务 (scrobbling) / Сервис Scrobbling (scrobbling)

**位置**：`src/libs/services/scrobbling/`  
**功能**：播放历史记录和同步

**Расположение**: `src/libs/services/scrobbling/`  
**Функции**: запись истории воспроизведения и синхронизация

**支持的后端**：
- **内部后端**：本地播放历史记录
- **ListenBrainz**：与 ListenBrainz 服务同步

**Поддерживаемые бэкенды**:
- **Внутренний бэкенд**: локальная запись истории воспроизведения
- **ListenBrainz**: синхронизация с сервисом ListenBrainz

#### 5.8 反馈服务 (feedback) / Сервис обратной связи (feedback)

**位置**：`src/libs/services/feedback/`  
**功能**：用户反馈管理（喜欢/不喜欢）

**Расположение**: `src/libs/services/feedback/`  
**Функции**: управление обратной связью пользователей (нравится/не нравится)

**支持的后端**：
- **内部后端**：本地反馈存储
- **ListenBrainz**：与 ListenBrainz 同步反馈

**Поддерживаемые бэкенды**:
- **Внутренний бэкенд**: локальное хранение обратной связи
- **ListenBrainz**: синхронизация обратной связи с ListenBrainz

---

### 6. Subsonic API (subsonic) / Subsonic API (subsonic)

**位置**：`src/libs/subsonic/`  
**功能**：实现 Subsonic API 协议

**Расположение**: `src/libs/subsonic/`  
**Функции**: реализация протокола Subsonic API

**特性**：
- 完全兼容 Subsonic API 1.16.1
- 支持所有主要端点（艺术家、专辑、曲目、搜索等）
- 支持多种响应格式（XML、JSON）
- Token 和密码认证

**Особенности**:
- Полная совместимость с Subsonic API 1.16.1
- Поддержка всех основных конечных точек (исполнители, альбомы, треки, поиск и т.д.)
- Поддержка множественных форматов ответов (XML, JSON)
- Аутентификация по токену и паролю

---

### 7. Web 界面 (ui) / Веб-интерфейс (ui)

**位置**：`src/lms/ui/`  
**功能**：用户界面和交互

**Расположение**: `src/lms/ui/`  
**Функции**: пользовательский интерфейс и взаимодействие

#### 7.1 核心组件 / Основные компоненты

- **LmsApplication**：主应用类，管理用户会话和路由
- **Auth**：认证模块，处理用户登录
- **MediaPlayer**：媒体播放器控件，与前端 JavaScript 播放器交互
- **PlayQueue**：播放队列管理，支持多种播放模式
- **ModalManager**：模态框管理器
- **NotificationContainer**：通知消息容器

- **LmsApplication**: главный класс приложения, управляет пользовательскими сессиями и роутингом
- **Auth**: модуль аутентификации, обрабатывает вход пользователей
- **MediaPlayer**: виджет медиаплеера, взаимодействует с JavaScript-плеером на фронтенде
- **PlayQueue**: управление очередью воспроизведения, поддерживает различные режимы воспроизведения
- **ModalManager**: менеджер модальных окон
- **NotificationContainer**: контейнер уведомлений

#### 7.2 探索视图 (explore) / Представления исследования (explore)

- **Explore**：主探索容器
- **ArtistsView**：艺术家列表视图
- **ReleasesView**：专辑列表视图
- **TracksView**：曲目列表视图
- **TrackListsView**：播放列表视图
- **Filters**：过滤器组件
- **PlayQueueController**：播放队列控制器

- **Explore**: главный контейнер исследования
- **ArtistsView**: представление списка исполнителей
- **ReleasesView**: представление списка альбомов
- **TracksView**: представление списка треков
- **TrackListsView**: представление списка плейлистов
- **Filters**: компонент фильтров
- **PlayQueueController**: контроллер очереди воспроизведения

#### 7.3 管理界面 (admin) / Административный интерфейс (admin)

- **UsersView**：用户管理
- **MediaLibrariesView**：媒体库管理
- **ScannerController**：扫描器控制
- **ScanSettingsView**：扫描设置
- **InitWizardView**：初始化向导
- **DebugToolsView**：调试工具

- **UsersView**: управление пользователями
- **MediaLibrariesView**: управление медиатеками
- **ScannerController**: управление сканером
- **ScanSettingsView**: настройки сканирования
- **InitWizardView**: мастер инициализации
- **DebugToolsView**: инструменты отладки

#### 7.4 资源处理 (resource) / Обработка ресурсов (resource)

- **ArtworkResource**：封面图片资源
- **AudioFileResource**：原始音频文件资源
- **AudioTranscodingResource**：转码音频资源
- **DownloadResource**：下载资源（ZIP 打包）

- **ArtworkResource**: ресурсы изображений обложек
- **AudioFileResource**: ресурсы исходных аудиофайлов
- **AudioTranscodingResource**: ресурсы транскодированного аудио
- **DownloadResource**: ресурсы загрузки (упаковка в ZIP)

#### 7.5 通用组件 (common) / Общие компоненты (common)

- **InfiniteScrollingContainer**：无限滚动容器
- **Template**：模板基类
- **LoadingIndicator**：加载指示器
- **各种验证器**：表单验证器（密码、用户名、UUID 等）

- **InfiniteScrollingContainer**: контейнер с бесконечной прокруткой
- **Template**: базовый класс шаблонов
- **LoadingIndicator**: индикатор загрузки
- **Различные валидаторы**: валидаторы форм (пароль, имя пользователя, UUID и т.д.)

---

## 💻 环境要求 / Требования к окружению

### 操作系统 / Операционная система
- **Linux**（推荐 Ubuntu 20.04+、Debian 11+、Fedora 34+）
- **WSL2**（Windows 上的 Linux 子系统）

- **Linux** (рекомендуется Ubuntu 20.04+, Debian 11+, Fedora 34+)
- **WSL2** (подсистема Linux в Windows)

### 编译工具 / Инструменты сборки
- **CMake** 3.20 或更高版本
- **C++20 编译器**：
  - GCC 10 或更高版本
  - Clang 12 或更高版本

- **CMake** 3.20 или выше
- **Компилятор C++20**:
  - GCC 10 или выше
  - Clang 12 или выше

### 必需依赖 / Обязательные зависимости
- **Wt 框架** 4.12.1 或更高版本
- **SQLite3** 3.35 或更高版本
- **Boost** 1.70 或更高版本
- **OpenSSL** 1.1.1 或更高版本
- **libconfig++** 1.5 或更高版本

- **Фреймворк Wt** 4.12.1 или выше
- **SQLite3** 3.35 или выше
- **Boost** 1.70 или выше
- **OpenSSL** 1.1.1 или выше
- **libconfig++** 1.5 или выше

### 可选依赖 / Опциональные зависимости
- **TagLib** 1.11+（音频标签读取）
- **FFmpeg** 4.0+（音频转码和元数据提取）
- **GraphicsMagick** 1.3+（图像处理，推荐）
- **PAM**（PAM 认证支持）

- **TagLib** 1.11+ (чтение тегов аудио)
- **FFmpeg** 4.0+ (транскодирование аудио и извлечение метаданных)
- **GraphicsMagick** 1.3+ (обработка изображений, рекомендуется)
- **PAM** (поддержка PAM-аутентификации)

---

## 🔨 构建与安装 / Сборка и установка

### 构建项目 / Сборка проекта

```bash
# 创建构建目录
# Создание каталога сборки
mkdir build && cd build

# 配置项目（Release 模式）
# Настройка проекта (режим Release)
cmake .. -DCMAKE_BUILD_TYPE=Release

# 编译（使用所有可用 CPU 核心）
# Компиляция (использование всех доступных ядер CPU)
make -j$(nproc)

# 安装（可选，需要 root 权限）
# Установка (опционально, требуется права root)
sudo make install
```

### 调试构建 / Отладочная сборка

```bash
mkdir build && cd build
cmake .. -DCMAKE_BUILD_TYPE=Debug
make -j$(nproc)
```

### 运行 / Запуск

```bash
# 运行编译后的可执行文件
# Запуск скомпилированного исполняемого файла
./build/src/lms/lms /path/to/lms.conf
```

---

## ⚙️ 配置说明 / Описание конфигурации

### 配置文件位置 / Расположение файла конфигурации

默认配置文件位置：`/etc/lms/lms.conf` 或 `conf/lms.conf`

Расположение файла конфигурации по умолчанию: `/etc/lms/lms.conf` или `conf/lms.conf`

### 主要配置项 / Основные параметры конфигурации

#### 服务器配置 / Конфигурация сервера
```ini
# HTTP 服务器配置
# Конфигурация HTTP-сервера
listen-addr = "0.0.0.0";        # 监听地址 / адрес прослушивания
listen-port = 5082;             # 监听端口 / порт прослушивания
http-server-thread-count = 0;   # 线程数（0 = 自动） / количество потоков (0 = автоматически)

# TLS/SSL 配置（可选）
# Конфигурация TLS/SSL (опционально)
tls-enable = false;             # 启用 TLS / включить TLS
tls-cert = "/path/to/cert.pem"; # 证书文件 / файл сертификата
tls-key = "/path/to/key.pem";   # 私钥文件 / файл приватного ключа
```

#### 数据库配置 / Конфигурация БД
```ini
# 工作目录（数据库和缓存存储位置）
# Рабочий каталог (место хранения БД и кэша)
working-dir = "/var/lms";

# 查询计划记录（性能分析）
# Запись планов запросов (анализ производительности)
db-record-query-plans = false;
```

#### 认证配置 / Конфигурация аутентификации
```ini
# 认证后端类型
# Тип бэкенда аутентификации
# 选项: "internal", "pam", "http-headers"
# Варианты: "internal", "pam", "http-headers"
authentication-backend = "internal";

# 登录限流配置
# Конфигурация ограничения входа
login-throttler-max-entries = 10000;
```

#### 扫描配置 / Конфигурация сканирования
```ini
# 扫描间隔（秒）
# Интервал сканирования (секунды)
scan-interval = 3600;

# 扫描设置
# Настройки сканирования
scan-extensions = ["mp3", "flac", "ogg", "m4a", "wav"];
```

#### 日志配置 / Конфигурация логирования
```ini
# 日志级别
# Уровень логирования
# 选项: "debug", "info", "warning", "error", "fatal"
# Варианты: "debug", "info", "warning", "error", "fatal"
log-min-severity = "info";

# 日志文件（可选，留空则输出到标准输出）
# Файл лога (опционально, оставить пустым для вывода в stdout)
log-file = "";
```

---

## 🚀 运行与使用 / Запуск и использование

### 首次启动 / Первый запуск

1. **复制配置文件** / **Копирование файла конфигурации**：
   ```bash
   cp conf/lms.conf.example conf/lms.conf
   ```

2. **编辑配置文件** / **Редактирование файла конфигурации**：
   根据你的环境修改配置项（媒体库路径、端口等）
   Измените параметры конфигурации в соответствии с вашим окружением (путь к медиатеке, порт и т.д.)

3. **启动服务器** / **Запуск сервера**：
   ```bash
   ./build/src/lms/lms conf/lms.conf
   ```

4. **访问 Web 界面** / **Доступ к веб-интерфейсу**：
   在浏览器中打开 `http://localhost:5082`
   Откройте в браузере `http://localhost:5082`

5. **初始化向导** / **Мастер инициализации**：
   首次启动时会显示初始化向导，创建第一个管理员账户
   При первом запуске отобразится мастер инициализации для создания первой учётной записи администратора

### 基本操作 / Основные операции

#### 添加媒体库 / Добавление медиатеки
1. 登录管理员账户
2. 进入"媒体库"管理页面
3. 点击"添加媒体库"
4. 配置媒体库路径和扫描设置
5. 保存并触发扫描

1. Войдите в учётную запись администратора
2. Перейдите на страницу управления "Медиатеки"
3. Нажмите "Добавить медиатеку"
4. Настройте путь к медиатеке и параметры сканирования
5. Сохраните и запустите сканирование

#### 播放音乐 / Воспроизведение музыки
1. 浏览艺术家、专辑或曲目
2. 点击播放按钮或右键菜单选择播放方式
3. 使用播放队列管理播放列表
4. 调整播放器设置（转码、ReplayGain 等）

1. Просматривайте исполнителей, альбомы или треки
2. Нажмите кнопку воспроизведения или выберите способ воспроизведения из контекстного меню
3. Используйте очередь воспроизведения для управления плейлистом
4. Настройте параметры плеера (транскодирование, ReplayGain и т.д.)

---

## 🔌 API 支持 / Поддержка API

### Subsonic API

LMS 完全兼容 Subsonic API 1.16.1 协议，支持所有基于 Subsonic 的音乐客户端。

LMS полностью совместим с протоколом Subsonic API 1.16.1, поддерживает все музыкальные клиенты на базе Subsonic.

#### 支持的客户端 / Поддерживаемые клиенты
- **DSub**（Android）
- **Subsonic**（各种平台）
- **Amarok**（Linux）
- **Clementine**（跨平台）
- 以及其他所有兼容 Subsonic API 的客户端

- **DSub** (Android)
- **Subsonic** (различные платформы)
- **Amarok** (Linux)
- **Clementine** (кроссплатформенный)
- И все другие клиенты, совместимые с Subsonic API

#### API 端点 / Конечные точки API

API 基础路径：`/rest/`

Базовый путь API: `/rest/`

主要端点包括：
- `ping`：服务器状态检查
- `getArtists`：获取艺术家列表
- `getAlbum`：获取专辑信息
- `getSong`：获取曲目信息
- `stream`：流式传输音频
- `search2`：搜索功能
- 等等...

Основные конечные точки включают:
- `ping`: проверка статуса сервера
- `getArtists`: получение списка исполнителей
- `getAlbum`: получение информации об альбоме
- `getSong`: получение информации о треке
- `stream`: потоковая передача аудио
- `search2`: функция поиска
- и т.д.

---

## 👨‍💻 开发指南 / Руководство разработчика

### 项目结构 / Структура проекта

```
LightweightMusicServer/
├── src/
│   ├── libs/              # 核心库
│   │   ├── core/         # 核心工具库
│   │   ├── database/     # 数据库层
│   │   ├── audio/        # 音频处理
│   │   ├── image/        # 图像处理
│   │   ├── services/     # 服务层
│   │   ├── som/          # 自组织映射（用于推荐）
│   │   └── subsonic/     # Subsonic API
│   └── lms/              # 主程序
│       └── ui/           # Web 界面
├── conf/                 # 配置文件
├── docroot/              # 静态资源（CSS、JS）
├── approot/              # 应用资源（模板、翻译）
├── cmake/                # CMake 模块
└── scripts/              # 构建脚本

LightweightMusicServer/
├── src/
│   ├── libs/              # Основные библиотеки
│   │   ├── core/         # Основная утилитная библиотека
│   │   ├── database/     # Слой БД
│   │   ├── audio/        # Обработка аудио
│   │   ├── image/        # Обработка изображений
│   │   ├── services/     # Слой сервисов
│   │   ├── som/          # Самоорганизующиеся карты (для рекомендаций)
│   │   └── subsonic/     # Subsonic API
│   └── lms/              # Главная программа
│       └── ui/           # Веб-интерфейс
├── conf/                 # Файлы конфигурации
├── docroot/              # Статические ресурсы (CSS, JS)
├── approot/              # Ресурсы приложения (шаблоны, переводы)
├── cmake/                # Модули CMake
└── scripts/              # Скрипты сборки
```

### 代码风格 / Стиль кода

- 使用 C++20 标准特性
- 遵循 RAII 原则
- 使用智能指针管理内存
- 异常安全编程
- 详细的代码注释（中俄双语）

- Использование функций стандарта C++20
- Следование принципам RAII
- Использование умных указателей для управления памятью
- Программирование с безопасностью исключений
- Подробные комментарии в коде (китайский и русский)

### 贡献指南 / Руководство по вкладу

欢迎贡献代码！请遵循以下步骤：

Добро пожаловать к вкладу в код! Пожалуйста, следуйте следующим шагам:

1. Fork 项目仓库
2. 创建功能分支
3. 提交更改
4. 创建 Pull Request

1. Форк репозитория проекта
2. Создайте ветку функции
3. Зафиксируйте изменения
4. Создайте Pull Request

---

## 📄 许可证 / Лицензия

LMS 基于 GNU General Public License v3.0 许可证发布。

LMS распространяется под лицензией GNU General Public License v3.0.

---

## 🙏 致谢 / Благодарности

感谢所有为这个项目做出贡献的开发者和用户！

Спасибо всем разработчикам и пользователям, внесшим вклад в этот проект!

---

## 📞 支持与反馈 / Поддержка и обратная связь

如有问题或建议，请通过以下方式联系：

Если у вас есть вопросы или предложения, пожалуйста, свяжитесь через:

- **GitHub Issues**：报告 Bug 或提出功能请求
- **文档**：查看项目文档获取更多信息

- **GitHub Issues**: сообщить об ошибке или запросить функцию
- **Документация**: просмотреть документацию проекта для получения дополнительной информации

---

**享受你的音乐！/ Наслаждайтесь своей музыкой!** 🎵
