# LMS é¡¹ç›®ç¯å¢ƒæ­å»ºæŒ‡å—

## ğŸ“‹ ç›®å½•
1. [ç¯å¢ƒè¦æ±‚](#ç¯å¢ƒè¦æ±‚)
2. [Windows + WSL2 ç¯å¢ƒæ­å»º](#windows--wsl2-ç¯å¢ƒæ­å»º)
3. [ä¾èµ–åº“å®‰è£…](#ä¾èµ–åº“å®‰è£…)
4. [Wt æ¡†æ¶å®‰è£…](#wt-æ¡†æ¶å®‰è£…)
5. [é¡¹ç›®æ„å»º](#é¡¹ç›®æ„å»º)
6. [éªŒè¯å®‰è£…](#éªŒè¯å®‰è£…)
7. [å¸¸è§é—®é¢˜](#å¸¸è§é—®é¢˜)

---

## ç¯å¢ƒè¦æ±‚

### æ“ä½œç³»ç»Ÿ
- **Windows 10/11** + **WSL2 (Ubuntu 20.04/22.04)**ï¼ˆæ¨èï¼‰
- æˆ– **Linux** (Ubuntu/Debian)

### å¿…éœ€å·¥å…·
- **C++20 ç¼–è¯‘å™¨**ï¼šGCC 11+ æˆ– Clang 14+
- **CMake**ï¼š3.12 æˆ–æ›´é«˜ç‰ˆæœ¬
- **Git**
- **pkg-config**

### ä¾èµ–åº“
- Boost (å®Œæ•´å®‰è£…)
- FFmpeg 4.0+
- TagLib 2.1.1+
- SQLite3
- OpenSSL
- å…¶ä»–å¼€å‘åº“ï¼ˆè§ä¸‹æ–¹è¯¦ç»†åˆ—è¡¨ï¼‰

---

## Windows + WSL2 ç¯å¢ƒæ­å»º

### æ­¥éª¤ 1ï¼šè¿›å…¥ WSL2 ç¯å¢ƒ

```powershell
# åœ¨ PowerShell ä¸­
wsl
```

### æ­¥éª¤ 2ï¼šæ›´æ–°ç³»ç»ŸåŒ…

```bash
# åœ¨ WSL ä¸­æ‰§è¡Œ
sudo apt update
sudo apt upgrade -y
```

### æ­¥éª¤ 3ï¼šå®‰è£…åŸºç¡€å¼€å‘å·¥å…·

```bash
# å®‰è£…ç¼–è¯‘å·¥å…·é“¾
sudo apt install -y \
  build-essential \
  cmake \
  git \
  pkg-config \
  ninja-build \
  software-properties-common

# å®‰è£… C++ ç¼–è¯‘å™¨ï¼ˆç¡®ä¿æ”¯æŒ C++20ï¼‰
sudo apt install -y \
  g++-12 \
  gcc-12 \
  clang-14

# è®¾ç½®é»˜è®¤ç¼–è¯‘å™¨ï¼ˆå¯é€‰ï¼‰
sudo update-alternatives --install /usr/bin/gcc gcc /usr/bin/gcc-12 100
sudo update-alternatives --install /usr/bin/g++ g++ /usr/bin/g++-12 100

# å®‰è£…ä»£ç æ ¼å¼åŒ–å·¥å…·
sudo apt install -y \
  clang-format \
  clang-tidy

# å®‰è£…è°ƒè¯•å·¥å…·
sudo apt install -y \
  gdb \
  valgrind
```

### æ­¥éª¤ 4ï¼šéªŒè¯ç¼–è¯‘å™¨ç‰ˆæœ¬

```bash
g++ --version  # åº”è¯¥æ˜¾ç¤º 11.0 æˆ–æ›´é«˜ç‰ˆæœ¬
cmake --version  # åº”è¯¥æ˜¾ç¤º 3.12 æˆ–æ›´é«˜ç‰ˆæœ¬
```

---

## ä¾èµ–åº“å®‰è£…

### å®‰è£…æ‰€æœ‰ä¾èµ–åº“ï¼ˆä¸€æ¬¡æ€§å®‰è£…ï¼‰

```bash
sudo apt install -y \
  libboost-all-dev \
  libavcodec-dev \
  libavformat-dev \
  libavutil-dev \
  libavfilter-dev \
  libswscale-dev \
  libswresample-dev \
  ffmpeg \
  libtag1-dev \
  libstb-dev \
  libconfig++-dev \
  libpam0g-dev \
  libpugixml-dev \
  libgtest-dev \
  libarchive-dev \
  libxxhash-dev \
  libssl-dev \
  libsqlite3-dev \
  zlib1g-dev \
  libbz2-dev
```

### éªŒè¯ä¾èµ–åº“å®‰è£…

```bash
# æ£€æŸ¥å…³é”®åº“
pkg-config --modversion libavcodec
pkg-config --modversion libavformat
pkg-config --modversion taglib
```

---

## Wt æ¡†æ¶å®‰è£…

Wt æ¡†æ¶ä¸åœ¨æ ‡å‡†ä»“åº“ä¸­ï¼Œéœ€è¦ä»æºç ç¼–è¯‘å®‰è£…ã€‚

### æ–¹æ³• 1ï¼šä½¿ç”¨å®‰è£…è„šæœ¬ï¼ˆæ¨èï¼‰

```bash
# åœ¨é¡¹ç›®æ ¹ç›®å½•æ‰§è¡Œ
cd ~
bash lms/scripts/install-wt.sh
```

### æ–¹æ³• 2ï¼šæ‰‹åŠ¨å®‰è£…

```bash
# 1. ä¸‹è½½ Wt æºç 
cd ~
wget https://github.com/emweb/wt/archive/refs/tags/4.12.1.tar.gz
tar -xzf 4.12.1.tar.gz
cd wt-4.12.1

# 2. åˆ›å»ºæ„å»ºç›®å½•
mkdir build && cd build

# 3. é…ç½® CMake
cmake .. \
  -DCMAKE_BUILD_TYPE=Release \
  -DCMAKE_INSTALL_PREFIX=/usr/local \
  -DSHARED_LIBS=ON \
  -DWT_BUILD_EXAMPLES=OFF \
  -DWT_BUILD_TESTS=OFF

# 4. ç¼–è¯‘ï¼ˆè¿™å¯èƒ½éœ€è¦ 10-30 åˆ†é’Ÿï¼‰
make -j$(nproc)

# 5. å®‰è£…
sudo make install

# 6. æ›´æ–°åº“ç¼“å­˜
sudo ldconfig

# 7. éªŒè¯å®‰è£…
pkg-config --modversion wt
```

### éªŒè¯ Wt å®‰è£…

```bash
# æ£€æŸ¥ Wt åº“æ–‡ä»¶
ls /usr/local/lib/libwt* | head -5

# æ£€æŸ¥å¤´æ–‡ä»¶
ls /usr/local/include/Wt/ | head -5

# æ£€æŸ¥ pkg-config
pkg-config --modversion wt
```

---

## é¡¹ç›®æ„å»º

### æ­¥éª¤ 1ï¼šè¿›å…¥é¡¹ç›®ç›®å½•

```bash
# å¦‚æœé¡¹ç›®åœ¨ Windows æ–‡ä»¶ç³»ç»Ÿä¸­ï¼Œéœ€è¦å…ˆè¿›å…¥
cd /mnt/e/LightweightMusicServer
# æˆ–è€…å¦‚æœé¡¹ç›®åœ¨ WSL æ–‡ä»¶ç³»ç»Ÿä¸­
cd ~/LightweightMusicServer
```

### æ­¥éª¤ 2ï¼šåˆ›å»ºæ„å»ºç›®å½•

```bash
mkdir -p build
cd build
```

### æ­¥éª¤ 3ï¼šé…ç½® CMake

```bash
# Debug æ¨¡å¼ï¼ˆå¼€å‘ç”¨ï¼‰
cmake .. \
  -DCMAKE_BUILD_TYPE=Debug \
  -DCMAKE_EXPORT_COMPILE_COMMANDS=ON

# æˆ–è€… Release æ¨¡å¼ï¼ˆç”Ÿäº§ç”¨ï¼‰
# cmake .. -DCMAKE_BUILD_TYPE=Release
```

### æ­¥éª¤ 4ï¼šç¼–è¯‘é¡¹ç›®

```bash
# ç¼–è¯‘ï¼ˆä½¿ç”¨æ‰€æœ‰ CPU æ ¸å¿ƒï¼‰
make -j$(nproc)

# æˆ–è€…æŒ‡å®šæ ¸å¿ƒæ•°
# make -j4
```

### æ­¥éª¤ 5ï¼šæ£€æŸ¥ç¼–è¯‘ç»“æœ

```bash
# æ£€æŸ¥ç”Ÿæˆçš„å¯æ‰§è¡Œæ–‡ä»¶
ls -lh src/lms/lms

# è¿è¡Œç¨‹åºï¼ˆéœ€è¦é…ç½®æ–‡ä»¶ï¼‰
./src/lms/lms ../conf/lms.conf
```

---

## éªŒè¯å®‰è£…

### 1. æ£€æŸ¥æ‰€æœ‰ä¾èµ–

è¿è¡ŒéªŒè¯è„šæœ¬ï¼š

```bash
bash scripts/check-dependencies.sh
```

### 2. è¿è¡Œæµ‹è¯•ï¼ˆå¦‚æœæœ‰ï¼‰

```bash
cd build
ctest
```

### 3. åˆ›å»ºåŸºæœ¬é…ç½®æ–‡ä»¶

```bash
# åˆ›å»ºé…ç½®ç›®å½•
mkdir -p conf

# åˆ›å»ºåŸºæœ¬é…ç½®æ–‡ä»¶ï¼ˆå¦‚æœä¸å­˜åœ¨ï¼‰
# å¯ä»¥ä»é¡¹ç›®æ¨¡æ¿å¤åˆ¶æˆ–æ‰‹åŠ¨åˆ›å»º
```

---

## VS Code é…ç½®ï¼ˆå¯é€‰ï¼‰

### 1. å®‰è£… VS Code æ‰©å±•

åœ¨ VS Code ä¸­å®‰è£…ï¼š
- **C/C++** (Microsoft)
- **CMake Tools** (Microsoft)
- **Remote - WSL** (Microsoft)

### 2. é…ç½® VS Code

åˆ›å»º `.vscode/settings.json`ï¼š

```json
{
  "C_Cpp.default.cppStandard": "c++20",
  "C_Cpp.default.compilerPath": "/usr/bin/g++",
  "C_Cpp.default.includePath": [
    "${workspaceFolder}/**",
    "/usr/local/include",
    "/usr/include"
  ],
  "files.associations": {
    "*.hpp": "cpp",
    "*.cpp": "cpp"
  },
  "editor.formatOnSave": true,
  "C_Cpp.clang_format_style": "file"
}
```

### 3. é…ç½®è°ƒè¯•

åˆ›å»º `.vscode/launch.json`ï¼ˆè§è¯¦ç»†å¼€å‘æ­¥éª¤æŒ‡å—ï¼‰

---

## å¸¸è§é—®é¢˜

### é—®é¢˜ 1ï¼šæ‰¾ä¸åˆ° Wt åº“

**è§£å†³æ–¹æ¡ˆ**ï¼š
```bash
# æ£€æŸ¥åº“è·¯å¾„
sudo ldconfig

# æ‰‹åŠ¨æ·»åŠ åº“è·¯å¾„ï¼ˆå¦‚æœéœ€è¦ï¼‰
export LD_LIBRARY_PATH=/usr/local/lib:$LD_LIBRARY_PATH
```

### é—®é¢˜ 2ï¼šCMake æ‰¾ä¸åˆ°ä¾èµ–

**è§£å†³æ–¹æ¡ˆ**ï¼š
```bash
# æ£€æŸ¥ pkg-config
pkg-config --list-all | grep wt

# å¦‚æœæ‰¾ä¸åˆ°ï¼Œå¯èƒ½éœ€è¦è®¾ç½® PKG_CONFIG_PATH
export PKG_CONFIG_PATH=/usr/local/lib/pkgconfig:$PKG_CONFIG_PATH
```

### é—®é¢˜ 3ï¼šç¼–è¯‘é”™è¯¯ï¼šC++20 ç‰¹æ€§ä¸æ”¯æŒ

**è§£å†³æ–¹æ¡ˆ**ï¼š
```bash
# ç¡®ä¿ä½¿ç”¨æ­£ç¡®çš„ç¼–è¯‘å™¨ç‰ˆæœ¬
g++ --version

# åœ¨ CMakeLists.txt ä¸­æ˜ç¡®æŒ‡å®š C++20
# set(CMAKE_CXX_STANDARD 20)
```

### é—®é¢˜ 4ï¼šWSL2 ä¸­æ–‡ä»¶ç³»ç»Ÿæ€§èƒ½æ…¢

**è§£å†³æ–¹æ¡ˆ**ï¼š
- å°†é¡¹ç›®æ”¾åœ¨ WSL2 æ–‡ä»¶ç³»ç»Ÿä¸­ï¼ˆ`~/` è€Œä¸æ˜¯ `/mnt/c/`ï¼‰
- æˆ–ä½¿ç”¨ `wsl.conf` ä¼˜åŒ–æŒ‚è½½é€‰é¡¹

### é—®é¢˜ 5ï¼šå†…å­˜ä¸è¶³

**è§£å†³æ–¹æ¡ˆ**ï¼š
```bash
# å‡å°‘å¹¶è¡Œç¼–è¯‘æ•°
make -j2  # è€Œä¸æ˜¯ make -j$(nproc)

# æˆ–è€…åœ¨ WSL2 é…ç½®ä¸­å¢åŠ å†…å­˜é™åˆ¶
```

---

## ä¸‹ä¸€æ­¥

ç¯å¢ƒæ­å»ºå®Œæˆåï¼Œè¯·ï¼š

1. âœ… éªŒè¯æ‰€æœ‰ä¾èµ–å·²å®‰è£…
2. âœ… æˆåŠŸç¼–è¯‘é¡¹ç›®
3. âœ… é˜…è¯» `è¯¦ç»†å¼€å‘æ­¥éª¤æŒ‡å—.md`
4. âœ… å¼€å§‹å­¦ä¹ é¡¹ç›®ä»£ç ï¼ˆä» `src/lms/main.cpp` å¼€å§‹ï¼‰

---

## å¿«é€Ÿå‚è€ƒ

### å¸¸ç”¨å‘½ä»¤

```bash
# è¿›å…¥ WSL
wsl

# æ›´æ–°ç³»ç»Ÿ
sudo apt update && sudo apt upgrade -y

# æ£€æŸ¥ç¼–è¯‘å™¨ç‰ˆæœ¬
g++ --version

# æ£€æŸ¥ CMake ç‰ˆæœ¬
cmake --version

# ç¼–è¯‘é¡¹ç›®
cd build && make -j$(nproc)

# æ¸…ç†æ„å»º
cd build && make clean

# é‡æ–°é…ç½®
cd build && rm -rf * && cmake .. -DCMAKE_BUILD_TYPE=Debug
```

---

ç¥ä½ ç¯å¢ƒæ­å»ºé¡ºåˆ©ï¼ğŸš€

