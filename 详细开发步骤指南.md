# LMS é¡¹ç›®è¯¦ç»†å¼€å‘æ­¥éª¤æŒ‡å—

## ğŸ“‹ ç›®å½•

1. [å¼€å‘ç¯å¢ƒå‡†å¤‡](#1-å¼€å‘ç¯å¢ƒå‡†å¤‡)
2. [é¡¹ç›®ç»“æ„ç†è§£](#2-é¡¹ç›®ç»“æ„ç†è§£)
3. [ä»£ç é£æ ¼å’Œè§„èŒƒ](#3-ä»£ç é£æ ¼å’Œè§„èŒƒ)
4. [å¼€å‘å·¥ä½œæµç¨‹](#4-å¼€å‘å·¥ä½œæµç¨‹)
5. [æ„å»ºå’Œç¼–è¯‘](#5-æ„å»ºå’Œç¼–è¯‘)
6. [æµ‹è¯•](#6-æµ‹è¯•)
7. [è°ƒè¯•](#7-è°ƒè¯•)
8. [ä»£ç æäº¤](#8-ä»£ç æäº¤)
9. [å¸¸è§å¼€å‘ä»»åŠ¡](#9-å¸¸è§å¼€å‘ä»»åŠ¡)

---

## 1. å¼€å‘ç¯å¢ƒå‡†å¤‡

### 1.1 å¿…éœ€å·¥å…·å®‰è£…

#### Windows + WSL2 ç¯å¢ƒ

```bash
# 1. å®‰è£… WSL2ï¼ˆåœ¨ PowerShell ç®¡ç†å‘˜æ¨¡å¼ï¼‰
wsl --install

# 2. è¿›å…¥ WSL2
wsl

# 3. æ›´æ–°ç³»ç»Ÿ
sudo apt update && sudo apt upgrade -y
```

#### å®‰è£…å¼€å‘å·¥å…·é“¾

```bash
# åŸºç¡€ç¼–è¯‘å·¥å…·
sudo apt install -y \
  build-essential \
  cmake \
  git \
  pkg-config \
  ninja-build

# C++ ç¼–è¯‘å™¨ï¼ˆç¡®ä¿æ”¯æŒ C++20ï¼‰
sudo apt install -y \
  g++-12 \
  clang-14

# ä»£ç æ ¼å¼åŒ–å·¥å…·
sudo apt install -y \
  clang-format \
  clang-tidy

# è°ƒè¯•å·¥å…·
sudo apt install -y \
  gdb \
  valgrind
```

#### å®‰è£…é¡¹ç›®ä¾èµ–

```bash
# Boost åº“ï¼ˆå®Œæ•´å®‰è£…ï¼‰
sudo apt install -y libboost-all-dev

# FFmpeg å¼€å‘åº“
sudo apt install -y \
  libavcodec-dev \
  libavformat-dev \
  libavutil-dev \
  libavfilter-dev \
  libswscale-dev \
  libswresample-dev \
  ffmpeg

# å…¶ä»–ä¾èµ–
sudo apt install -y \
  libstb-dev \
  libconfig++-dev \
  libtag1-dev \
  libpam0g-dev \
  libpugixml-dev \
  libgtest-dev \
  libarchive-dev \
  libxxhash-dev \
  libssl-dev \
  libsqlite3-dev
```

#### å®‰è£… Wt æ¡†æ¶

```bash
cd ~
wget https://github.com/emweb/wt/archive/4.12.1.tar.gz
tar -xzf 4.12.1.tar.gz
cd wt-4.12.1

mkdir build && cd build
cmake .. \
  -DCMAKE_BUILD_TYPE=Release \
  -DCMAKE_INSTALL_PREFIX=/usr/local \
  -DSHARED_LIBS=ON

make -j$(nproc)
sudo make install
sudo ldconfig
```

### 1.2 é…ç½®å¼€å‘å·¥å…·

#### VS Code é…ç½®ï¼ˆæ¨èï¼‰

åˆ›å»º `.vscode/settings.json`ï¼š

```json
{
  "C_Cpp.default.cppStandard": "c++20",
  "C_Cpp.default.compilerPath": "/usr/bin/g++",
  "C_Cpp.default.includePath": [
    "${workspaceFolder}/**",
    "/usr/local/include",
    "/usr/include"
  ],
  "files.associations": {
    "*.hpp": "cpp",
    "*.cpp": "cpp"
  },
  "editor.formatOnSave": true,
  "editor.defaultFormatter": "ms-vscode.cpptools",
  "[cpp]": {
    "editor.defaultFormatter": "ms-vscode.cpptools",
    "editor.formatOnSave": true
  },
  "C_Cpp.clang_format_style": "file",
  "C_Cpp.clang_format_path": "/usr/bin/clang-format"
}
```

åˆ›å»º `.vscode/launch.json`ï¼ˆè°ƒè¯•é…ç½®ï¼‰ï¼š

```json
{
  "version": "0.2.0",
  "configurations": [
    {
      "name": "Debug LMS",
      "type": "cppdbg",
      "request": "launch",
      "program": "${workspaceFolder}/build/src/lms/lms",
      "args": ["${workspaceFolder}/conf/lms.conf"],
      "stopAtEntry": false,
      "cwd": "${workspaceFolder}",
      "environment": [],
      "externalConsole": false,
      "MIMode": "gdb",
      "setupCommands": [
        {
          "description": "Enable pretty-printing for gdb",
          "text": "-enable-pretty-printing",
          "ignoreFailures": true
        }
      ],
      "preLaunchTask": "build"
    }
  ]
}
```

åˆ›å»º `.vscode/tasks.json`ï¼ˆæ„å»ºä»»åŠ¡ï¼‰ï¼š

```json
{
  "version": "2.0.0",
  "tasks": [
    {
      "label": "build",
      "type": "shell",
      "command": "cmake --build build --config Debug -j$(nproc)",
      "group": {
        "kind": "build",
        "isDefault": true
      },
      "problemMatcher": ["$gcc"]
    },
    {
      "label": "clean",
      "type": "shell",
      "command": "cmake --build build --target clean"
    }
  ]
}
```

---

## 2. é¡¹ç›®ç»“æ„ç†è§£

### 2.1 ç›®å½•ç»“æ„è¯¦è§£

```
lms/
â”œâ”€â”€ src/                    # æºä»£ç ç›®å½•
â”‚   â”œâ”€â”€ libs/              # æ ¸å¿ƒåº“
â”‚   â”‚   â”œâ”€â”€ audio/         # éŸ³é¢‘å¤„ç†åº“
â”‚   â”‚   â”‚   â”œâ”€â”€ include/   # å…¬å…±æ¥å£ï¼ˆ.hppï¼‰
â”‚   â”‚   â”‚   â””â”€â”€ impl/      # å®ç°æ–‡ä»¶ï¼ˆ.cpp, .hppï¼‰
â”‚   â”‚   â”œâ”€â”€ core/          # æ ¸å¿ƒå·¥å…·åº“
â”‚   â”‚   â”œâ”€â”€ database/      # æ•°æ®åº“å±‚
â”‚   â”‚   â”œâ”€â”€ image/         # å›¾åƒå¤„ç†
â”‚   â”‚   â”œâ”€â”€ services/      # ä¸šåŠ¡æœåŠ¡
â”‚   â”‚   â”‚   â”œâ”€â”€ scanner/   # æ‰«ææœåŠ¡
â”‚   â”‚   â”‚   â”œâ”€â”€ auth/      # è®¤è¯æœåŠ¡
â”‚   â”‚   â”‚   â”œâ”€â”€ transcoding/ # è½¬ç æœåŠ¡
â”‚   â”‚   â”‚   â””â”€â”€ ...
â”‚   â”‚   â”œâ”€â”€ som/           # è‡ªç»„ç»‡æ˜ å°„
â”‚   â”‚   â””â”€â”€ subsonic/      # Subsonic API
â”‚   â”œâ”€â”€ lms/               # ä¸»ç¨‹åº
â”‚   â”‚   â”œâ”€â”€ main.cpp       # ç¨‹åºå…¥å£
â”‚   â”‚   â””â”€â”€ ui/            # Web UI ä»£ç 
â”‚   â””â”€â”€ tools/             # å·¥å…·ç¨‹åº
â”œâ”€â”€ approot/                # Web UI æ¨¡æ¿ï¼ˆXMLï¼‰
â”œâ”€â”€ docroot/                # é™æ€èµ„æºï¼ˆCSS, JSï¼‰
â”œâ”€â”€ conf/                   # é…ç½®æ–‡ä»¶
â”œâ”€â”€ cmake/                  # CMake æ¨¡å—
â””â”€â”€ build/                  # æ„å»ºç›®å½•ï¼ˆgitignoreï¼‰
```

### 2.2 ä»£ç ç»„ç»‡åŸåˆ™

#### æ¥å£å’Œå®ç°åˆ†ç¦»

- **include/**ï¼šå…¬å…±æ¥å£ï¼ˆ.hppï¼‰ï¼Œä¾›å…¶ä»–æ¨¡å—ä½¿ç”¨
- **impl/**ï¼šå®ç°æ–‡ä»¶ï¼ˆ.cpp, .hppï¼‰ï¼Œå†…éƒ¨å®ç°ç»†èŠ‚

**ç¤ºä¾‹**ï¼š
```
libs/audio/
â”œâ”€â”€ include/audio/
â”‚   â””â”€â”€ IAudioFileInfo.hpp  # æ¥å£å®šä¹‰
â””â”€â”€ impl/
    â””â”€â”€ ParseAudioFileInfo.cpp  # å®ç°
```

#### å‘½åè§„èŒƒ

- **æ¥å£ç±»**ï¼šä»¥ `I` å¼€å¤´ï¼Œå¦‚ `IAudioFileInfo`
- **å®ç°ç±»**ï¼šå…·ä½“åç§°ï¼Œå¦‚ `AudioFileInfo`
- **æ–‡ä»¶å‘½å**ï¼šä¸ç±»åä¸€è‡´ï¼Œä½¿ç”¨ PascalCase

### 2.3 CMake ç»“æ„

#### ä¸» CMakeLists.txt

```cmake
# è®¾ç½® C++20 æ ‡å‡†
set(CMAKE_CXX_STANDARD 20)

# æ·»åŠ å­ç›®å½•
add_subdirectory(src)
```

#### åº“çš„ CMakeLists.txt ç¤ºä¾‹

```cmake
# åˆ›å»ºåº“
add_library(lmsaudio
    impl/ParseAudioFileInfo.cpp
    ...
)

# è®¾ç½®åŒ…å«ç›®å½•
target_include_directories(lmsaudio PUBLIC
    include/
)

# é“¾æ¥ä¾èµ–
target_link_libraries(lmsaudio PUBLIC
    TagLib::TagLib
    ...
)
```

---

## 3. ä»£ç é£æ ¼å’Œè§„èŒƒ

### 3.1 ä»£ç æ ¼å¼åŒ–

é¡¹ç›®ä½¿ç”¨ `.clang-format` å®šä¹‰ä»£ç é£æ ¼ã€‚

#### æ ¼å¼åŒ–å‘½ä»¤

```bash
# æ ¼å¼åŒ–å•ä¸ªæ–‡ä»¶
clang-format -i src/lms/main.cpp

# æ ¼å¼åŒ–æ•´ä¸ªé¡¹ç›®
find src -name "*.cpp" -o -name "*.hpp" | xargs clang-format -i

# æ£€æŸ¥æ ¼å¼ï¼ˆä¸ä¿®æ”¹ï¼‰
clang-format --dry-run --Werror src/lms/main.cpp
```

#### ä¸»è¦é£æ ¼è§„åˆ™

- **åŸºäº Microsoft é£æ ¼**
- **C++20 æ ‡å‡†**
- **æŒ‡é’ˆå¯¹é½**ï¼šå·¦å¯¹é½ï¼ˆ`Type* ptr`ï¼‰
- **å‘½åç©ºé—´ç¼©è¿›**ï¼šå…¨éƒ¨ç¼©è¿›
- **åˆ—å®½é™åˆ¶**ï¼šæ— é™åˆ¶ï¼ˆColumnLimit: 0ï¼‰

### 3.2 ä»£ç æ£€æŸ¥

é¡¹ç›®ä½¿ç”¨ `.clang-tidy` è¿›è¡Œé™æ€åˆ†æã€‚

#### è¿è¡Œ clang-tidy

```bash
# æ£€æŸ¥å•ä¸ªæ–‡ä»¶
clang-tidy src/lms/main.cpp -- -I./src -I/usr/local/include

# æ£€æŸ¥æ•´ä¸ªé¡¹ç›®ï¼ˆéœ€è¦ compile_commands.jsonï¼‰
# é¦–å…ˆç”Ÿæˆ compile_commands.json
cd build
cmake .. -DCMAKE_EXPORT_COMPILE_COMMANDS=ON

# ç„¶åè¿è¡Œ clang-tidy
clang-tidy -p build src/**/*.cpp
```

#### ä¸»è¦æ£€æŸ¥è§„åˆ™

- **bugprone-***ï¼šæ½œåœ¨ bug
- **cppcoreguidelines-***ï¼šC++ æ ¸å¿ƒæŒ‡å—
- **performance-***ï¼šæ€§èƒ½é—®é¢˜
- **readability-***ï¼šå¯è¯»æ€§

### 3.3 ä»£ç è§„èŒƒè¦ç‚¹

#### å¤´æ–‡ä»¶ä¿æŠ¤

```cpp
#pragma once

// æˆ–ä¼ ç»Ÿæ–¹å¼
#ifndef LMS_CORE_LOGGER_HPP
#define LMS_CORE_LOGGER_HPP
// ...
#endif
```

#### å‘½åç©ºé—´

```cpp
namespace lms::core
{
    class Logger
    {
        // ...
    };
}
```

#### æ™ºèƒ½æŒ‡é’ˆ

ä¼˜å…ˆä½¿ç”¨æ™ºèƒ½æŒ‡é’ˆï¼š

```cpp
std::unique_ptr<IAudioFileInfo> parseAudioFile(...);
std::shared_ptr<IScannerService> scanner;
```

#### å¼‚å¸¸å¤„ç†

```cpp
try
{
    // ä»£ç 
}
catch (const std::exception& e)
{
    LMS_LOG(MAIN, ERROR, "Error: " << e.what());
    // å¤„ç†
}
```

---

## 4. å¼€å‘å·¥ä½œæµç¨‹

### 4.1 åˆå§‹åŒ–é¡¹ç›®

```bash
# 1. å…‹éš†é¡¹ç›®ï¼ˆå¦‚æœè¿˜æ²¡æœ‰ï¼‰
git clone https://github.com/epoupon/lms.git
cd lms

# 2. åˆ›å»ºæ„å»ºç›®å½•
mkdir build
cd build

# 3. é…ç½® CMakeï¼ˆDebug æ¨¡å¼ç”¨äºå¼€å‘ï¼‰
cmake .. \
  -DCMAKE_BUILD_TYPE=Debug \
  -DCMAKE_EXPORT_COMPILE_COMMANDS=ON

# 4. ç¼–è¯‘
make -j$(nproc)

# 5. è¿è¡Œæµ‹è¯•
ctest
```

### 4.2 æ—¥å¸¸å¼€å‘æµç¨‹

#### æ­¥éª¤ 1ï¼šåˆ›å»ºåŠŸèƒ½åˆ†æ”¯

```bash
# ä»ä¸»åˆ†æ”¯åˆ›å»ºæ–°åˆ†æ”¯
git checkout -b feature/my-new-feature

# æˆ–ä» develop åˆ†æ”¯
git checkout develop
git pull
git checkout -b feature/my-new-feature
```

#### æ­¥éª¤ 2ï¼šç¼–å†™ä»£ç 

1. **åˆ›å»ºæ–°æ–‡ä»¶**ï¼š
   - æ¥å£æ–‡ä»¶æ”¾åœ¨ `include/` ç›®å½•
   - å®ç°æ–‡ä»¶æ”¾åœ¨ `impl/` ç›®å½•
   - æ›´æ–°ç›¸åº”çš„ `CMakeLists.txt`

2. **ä¿®æ”¹ç°æœ‰ä»£ç **ï¼š
   - éµå¾ªç°æœ‰ä»£ç é£æ ¼
   - æ·»åŠ å¿…è¦çš„æ³¨é‡Š
   - æ›´æ–°ç›¸å…³æ–‡æ¡£

#### æ­¥éª¤ 3ï¼šæ ¼å¼åŒ–ä»£ç 

```bash
# æ ¼å¼åŒ–ä¿®æ”¹çš„æ–‡ä»¶
clang-format -i src/path/to/file.cpp

# æˆ–ä½¿ç”¨ VS Code çš„æ ¼å¼åŒ–åŠŸèƒ½ï¼ˆCtrl+Shift+Iï¼‰
```

#### æ­¥éª¤ 4ï¼šç¼–è¯‘å’Œæµ‹è¯•

```bash
cd build
make -j$(nproc)

# è¿è¡Œæµ‹è¯•
ctest

# æˆ–è¿è¡Œç‰¹å®šæµ‹è¯•
ctest -R TestName
```

#### æ­¥éª¤ 5ï¼šè°ƒè¯•ï¼ˆå¦‚æœ‰é—®é¢˜ï¼‰

è§ [ç¬¬ 7 èŠ‚ï¼šè°ƒè¯•](#7-è°ƒè¯•)

#### æ­¥éª¤ 6ï¼šæäº¤ä»£ç 

```bash
# 1. æŸ¥çœ‹ä¿®æ”¹
git status
git diff

# 2. æ·»åŠ æ–‡ä»¶
git add src/path/to/file.cpp

# 3. æäº¤ï¼ˆä½¿ç”¨æ¸…æ™°çš„æäº¤ä¿¡æ¯ï¼‰
git commit -m "feat: æ·»åŠ æ–°åŠŸèƒ½æè¿°

è¯¦ç»†è¯´æ˜ï¼š
- åšäº†ä»€ä¹ˆ
- ä¸ºä»€ä¹ˆè¿™æ ·åš
- å¦‚ä½•æµ‹è¯•"
```

### 4.3 Git å·¥ä½œæµå»ºè®®

#### æäº¤ä¿¡æ¯æ ¼å¼

```
<type>: <subject>

<body>

<footer>
```

**ç±»å‹ï¼ˆtypeï¼‰**ï¼š
- `feat`: æ–°åŠŸèƒ½
- `fix`: ä¿®å¤ bug
- `docs`: æ–‡æ¡£æ›´æ–°
- `style`: ä»£ç æ ¼å¼ï¼ˆä¸å½±å“åŠŸèƒ½ï¼‰
- `refactor`: é‡æ„
- `test`: æµ‹è¯•ç›¸å…³
- `chore`: æ„å»º/å·¥å…·ç›¸å…³

**ç¤ºä¾‹**ï¼š
```
feat: æ·»åŠ éŸ³é¢‘æ–‡ä»¶æ ¼å¼æ£€æµ‹åŠŸèƒ½

å®ç°äº†åŸºäºæ–‡ä»¶æ‰©å±•åçš„æ ¼å¼æ£€æµ‹ï¼Œæ”¯æŒ MP3ã€FLACã€OGG ç­‰æ ¼å¼ã€‚

æµ‹è¯•æ–¹æ³•ï¼š
1. è¿è¡Œæµ‹è¯•å¥—ä»¶
2. ä½¿ç”¨æµ‹è¯•éŸ³é¢‘æ–‡ä»¶éªŒè¯

Closes #123
```

---

## 5. æ„å»ºå’Œç¼–è¯‘

### 5.1 åŸºæœ¬æ„å»ºå‘½ä»¤

```bash
# é…ç½®ï¼ˆé¦–æ¬¡æˆ–ä¿®æ”¹ CMakeLists.txt åï¼‰
cd build
cmake .. -DCMAKE_BUILD_TYPE=Debug

# ç¼–è¯‘
make -j$(nproc)

# æ¸…ç†
make clean

# é‡æ–°ç¼–è¯‘
make -j$(nproc)
```

### 5.2 æ„å»ºé€‰é¡¹

#### Debug æ¨¡å¼ï¼ˆå¼€å‘ï¼‰

```bash
cmake .. -DCMAKE_BUILD_TYPE=Debug
```

ç‰¹ç‚¹ï¼š
- åŒ…å«è°ƒè¯•ç¬¦å·
- ä¼˜åŒ–å…³é—­
- æ–­è¨€å¯ç”¨

#### Release æ¨¡å¼ï¼ˆç”Ÿäº§ï¼‰

```bash
cmake .. -DCMAKE_BUILD_TYPE=Release
```

ç‰¹ç‚¹ï¼š
- ä¼˜åŒ–å¼€å¯
- è°ƒè¯•ç¬¦å·å¯èƒ½è¢«å‰¥ç¦»
- æ€§èƒ½æœ€ä½³

#### å…¶ä»–é€‰é¡¹

```bash
# å¯ç”¨æµ‹è¯•
cmake .. -DENABLE_TESTS=ON

# å¯ç”¨åŸºå‡†æµ‹è¯•
cmake .. -DBUILD_BENCHMARKS=ON

# å¯¼å‡ºç¼–è¯‘å‘½ä»¤ï¼ˆç”¨äº clang-tidyï¼‰
cmake .. -DCMAKE_EXPORT_COMPILE_COMMANDS=ON
```

### 5.3 å¢é‡ç¼–è¯‘

```bash
# åªç¼–è¯‘ä¿®æ”¹çš„æ–‡ä»¶
make -j$(nproc)

# åªç¼–è¯‘ç‰¹å®šç›®æ ‡
make lms

# æŸ¥çœ‹ç¼–è¯‘ä¾èµ–
make depend
```

### 5.4 å¸¸è§ç¼–è¯‘é—®é¢˜

#### é—®é¢˜ 1ï¼šæ‰¾ä¸åˆ°å¤´æ–‡ä»¶

```bash
# æ£€æŸ¥åŒ…å«è·¯å¾„
cmake .. --debug-output 2>&1 | grep include

# æ‰‹åŠ¨æ·»åŠ åŒ…å«è·¯å¾„ï¼ˆåœ¨ CMakeLists.txt ä¸­ï¼‰
target_include_directories(target_name PRIVATE
    /path/to/include
)
```

#### é—®é¢˜ 2ï¼šé“¾æ¥é”™è¯¯

```bash
# æ£€æŸ¥åº“è·¯å¾„
ldconfig -p | grep library_name

# åœ¨ CMakeLists.txt ä¸­æ·»åŠ åº“è·¯å¾„
target_link_directories(target_name PRIVATE
    /path/to/lib
)
```

---

## 6. æµ‹è¯•

### 6.1 è¿è¡Œæµ‹è¯•

```bash
# è¿è¡Œæ‰€æœ‰æµ‹è¯•
cd build
ctest

# è¯¦ç»†è¾“å‡º
ctest --verbose

# è¿è¡Œç‰¹å®šæµ‹è¯•
ctest -R TestName

# å¹¶è¡Œè¿è¡Œ
ctest -j$(nproc)
```

### 6.2 ç¼–å†™æµ‹è¯•

#### æµ‹è¯•æ–‡ä»¶ä½ç½®

- å•å…ƒæµ‹è¯•ï¼š`src/libs/*/test/`
- é›†æˆæµ‹è¯•ï¼š`src/libs/*/test/`

#### æµ‹è¯•ç¤ºä¾‹

```cpp
#include <gtest/gtest.h>
#include "core/Path.hpp"

TEST(PathTest, BasicOperations)
{
    lms::core::Path path{"/tmp/test"};
    
    EXPECT_TRUE(path.exists());
    EXPECT_FALSE(path.isDirectory());
}
```

#### æ·»åŠ åˆ° CMakeLists.txt

```cmake
# åœ¨ç›¸åº”çš„åº“çš„ CMakeLists.txt ä¸­
if(ENABLE_TESTS)
    add_executable(test_myfeature
        test/MyFeatureTest.cpp
    )
    
    target_link_libraries(test_myfeature PRIVATE
        lmscore
        GTest::gtest
        GTest::gtest_main
    )
    
    add_test(NAME MyFeatureTest COMMAND test_myfeature)
endif()
```

### 6.3 æµ‹è¯•æœ€ä½³å®è·µ

1. **æµ‹è¯•å‘½å**ï¼šæ¸…æ™°æè¿°æµ‹è¯•å†…å®¹
2. **æµ‹è¯•éš”ç¦»**ï¼šæ¯ä¸ªæµ‹è¯•ç‹¬ç«‹
3. **æµ‹è¯•è¦†ç›–**ï¼šè¦†ç›–ä¸»è¦åŠŸèƒ½ç‚¹
4. **è¾¹ç•Œæµ‹è¯•**ï¼šæµ‹è¯•è¾¹ç•Œæƒ…å†µ

---

## 7. è°ƒè¯•

### 7.1 ä½¿ç”¨ GDB

#### åŸºæœ¬è°ƒè¯•

```bash
# å¯åŠ¨è°ƒè¯•
gdb ./build/src/lms/lms

# è®¾ç½®å‚æ•°
(gdb) set args conf/lms.conf

# è®¾ç½®æ–­ç‚¹
(gdb) break main
(gdb) break src/lms/main.cpp:100

# è¿è¡Œ
(gdb) run

# å•æ­¥æ‰§è¡Œ
(gdb) step      # è¿›å…¥å‡½æ•°
(gdb) next      # ä¸‹ä¸€è¡Œ
(gdb) continue  # ç»§ç»­æ‰§è¡Œ

# æŸ¥çœ‹å˜é‡
(gdb) print variable_name
(gdb) print *pointer

# æŸ¥çœ‹è°ƒç”¨æ ˆ
(gdb) backtrace
(gdb) frame 1

# é€€å‡º
(gdb) quit
```

#### å¸¸ç”¨ GDB å‘½ä»¤

```bash
# åˆ—å‡ºä»£ç 
(gdb) list
(gdb) list 50,100

# æŸ¥çœ‹å˜é‡ç±»å‹
(gdb) ptype variable_name

# ç›‘è§†å˜é‡
(gdb) watch variable_name

# æ¡ä»¶æ–­ç‚¹
(gdb) break file.cpp:100 if condition

# å‘½ä»¤å†å²
(gdb) show commands
```

### 7.2 ä½¿ç”¨ VS Code è°ƒè¯•

1. æ‰“å¼€ `.vscode/launch.json`
2. è®¾ç½®æ–­ç‚¹ï¼ˆç‚¹å‡»è¡Œå·å·¦ä¾§ï¼‰
3. æŒ‰ F5 å¼€å§‹è°ƒè¯•
4. ä½¿ç”¨è°ƒè¯•å·¥å…·æ ï¼š
   - ç»§ç»­ï¼ˆF5ï¼‰
   - å•æ­¥è·³è¿‡ï¼ˆF10ï¼‰
   - å•æ­¥è¿›å…¥ï¼ˆF11ï¼‰
   - å•æ­¥è·³å‡ºï¼ˆShift+F11ï¼‰

### 7.3 æ—¥å¿—è°ƒè¯•

#### ä½¿ç”¨æ—¥å¿—ç³»ç»Ÿ

```cpp
#include "core/ILogger.hpp"

LMS_LOG(MODULE_NAME, INFO, "ä¿¡æ¯æ¶ˆæ¯");
LMS_LOG(MODULE_NAME, DEBUG, "è°ƒè¯•ä¿¡æ¯: " << variable);
LMS_LOG(MODULE_NAME, ERROR, "é”™è¯¯: " << error_message);
```

#### é…ç½®æ—¥å¿—çº§åˆ«

åœ¨ `conf/lms.conf` ä¸­ï¼š

```
log-min-severity = "debug";  # æ˜¾ç¤ºæ‰€æœ‰æ—¥å¿—
log-file = "/var/lms/lms.log";  # è¾“å‡ºåˆ°æ–‡ä»¶
```

### 7.4 Valgrindï¼ˆå†…å­˜æ£€æŸ¥ï¼‰

```bash
# æ£€æŸ¥å†…å­˜æ³„æ¼
valgrind --leak-check=full ./build/src/lms/lms conf/lms.conf

# æ£€æŸ¥æœªåˆå§‹åŒ–å†…å­˜
valgrind --track-origins=yes ./build/src/lms/lms conf/lms.conf
```

---

## 8. ä»£ç æäº¤

### 8.1 æäº¤å‰æ£€æŸ¥æ¸…å•

- [ ] ä»£ç èƒ½å¤Ÿç¼–è¯‘
- [ ] æ‰€æœ‰æµ‹è¯•é€šè¿‡
- [ ] ä»£ç å·²æ ¼å¼åŒ–ï¼ˆclang-formatï¼‰
- [ ] ä»£ç æ£€æŸ¥é€šè¿‡ï¼ˆclang-tidyï¼‰
- [ ] æäº¤ä¿¡æ¯æ¸…æ™°
- [ ] æ²¡æœ‰ä¸´æ—¶æ–‡ä»¶æˆ–è°ƒè¯•ä»£ç 

### 8.2 æäº¤æµç¨‹

```bash
# 1. æŸ¥çœ‹çŠ¶æ€
git status

# 2. æŸ¥çœ‹å·®å¼‚
git diff

# 3. æ·»åŠ æ–‡ä»¶
git add src/path/to/file.cpp

# 4. æäº¤
git commit -m "feat: åŠŸèƒ½æè¿°"

# 5. æ¨é€åˆ°è¿œç¨‹ï¼ˆå¦‚æœå·²è®¾ç½®ï¼‰
git push origin feature/my-new-feature
```

### 8.3 Pull Request æµç¨‹

1. **åˆ›å»º PR**ï¼š
   - åœ¨ GitHub ä¸Šåˆ›å»º Pull Request
   - ä»åŠŸèƒ½åˆ†æ”¯åˆ° `develop` åˆ†æ”¯

2. **PR æè¿°**ï¼š
   - è¯´æ˜åšäº†ä»€ä¹ˆ
   - ä¸ºä»€ä¹ˆè¿™æ ·åš
   - å¦‚ä½•æµ‹è¯•
   - ç›¸å…³ Issue

3. **ä»£ç å®¡æŸ¥**ï¼š
   - ç­‰å¾…å®¡æŸ¥
   - æ ¹æ®åé¦ˆä¿®æ”¹

4. **åˆå¹¶**ï¼š
   - å®¡æŸ¥é€šè¿‡ååˆå¹¶

---

## 9. å¸¸è§å¼€å‘ä»»åŠ¡

### 9.1 æ·»åŠ æ–°åŠŸèƒ½æ¨¡å—

#### æ­¥éª¤ 1ï¼šåˆ›å»ºç›®å½•ç»“æ„

```bash
mkdir -p src/libs/mymodule/include/mymodule
mkdir -p src/libs/mymodule/impl
```

#### æ­¥éª¤ 2ï¼šåˆ›å»ºæ¥å£æ–‡ä»¶

`src/libs/mymodule/include/mymodule/IMyModule.hpp`:

```cpp
#pragma once

namespace lms::mymodule
{
    class IMyModule
    {
    public:
        virtual ~IMyModule() = default;
        virtual void doSomething() = 0;
    };

    std::unique_ptr<IMyModule> createMyModule();
}
```

#### æ­¥éª¤ 3ï¼šåˆ›å»ºå®ç°æ–‡ä»¶

`src/libs/mymodule/impl/MyModule.cpp`:

```cpp
#include "mymodule/IMyModule.hpp"

namespace lms::mymodule
{
    class MyModule : public IMyModule
    {
    public:
        void doSomething() override
        {
            // å®ç°
        }
    };

    std::unique_ptr<IMyModule> createMyModule()
    {
        return std::make_unique<MyModule>();
    }
}
```

#### æ­¥éª¤ 4ï¼šåˆ›å»º CMakeLists.txt

`src/libs/mymodule/CMakeLists.txt`:

```cmake
add_library(lmsmymodule
    impl/MyModule.cpp
)

target_include_directories(lmsmymodule PUBLIC
    include/
)

target_link_libraries(lmsmymodule PUBLIC
    # ä¾èµ–åº“
)
```

#### æ­¥éª¤ 5ï¼šåœ¨ä¸» CMakeLists.txt ä¸­æ·»åŠ 

`src/libs/CMakeLists.txt`:

```cmake
add_subdirectory(mymodule)
```

### 9.2 ä¿®æ”¹ç°æœ‰åŠŸèƒ½

1. **æ‰¾åˆ°ç›¸å…³æ–‡ä»¶**ï¼šä½¿ç”¨ grep æˆ–ä»£ç æœç´¢
2. **ç†è§£ç°æœ‰å®ç°**ï¼šé˜…è¯»ä»£ç å’Œæ³¨é‡Š
3. **è¿›è¡Œä¿®æ”¹**ï¼šéµå¾ªç°æœ‰ä»£ç é£æ ¼
4. **æµ‹è¯•**ï¼šè¿è¡Œç›¸å…³æµ‹è¯•
5. **æ›´æ–°æ–‡æ¡£**ï¼šå¦‚æœ‰å¿…è¦

### 9.3 æ·»åŠ æ–°çš„ API ç«¯ç‚¹

#### ä½ç½®

`src/libs/subsonic/impl/endpoints/`

#### æ­¥éª¤

1. åˆ›å»ºç«¯ç‚¹æ–‡ä»¶ï¼š`MyEndpoint.cpp` å’Œ `MyEndpoint.hpp`
2. å®ç°ç«¯ç‚¹é€»è¾‘
3. åœ¨ `SubsonicResource.cpp` ä¸­æ³¨å†Œç«¯ç‚¹

### 9.4 æ·»åŠ æ–°çš„æ•°æ®åº“å¯¹è±¡

#### ä½ç½®

`src/libs/database/include/database/objects/`

#### æ­¥éª¤

1. åˆ›å»ºå¯¹è±¡å¤´æ–‡ä»¶ï¼š`MyObject.hpp`
2. åˆ›å»ºå®ç°æ–‡ä»¶ï¼š`src/libs/database/impl/objects/MyObject.cpp`
3. åœ¨ `Session.cpp` ä¸­æ³¨å†Œæ˜ å°„
4. åˆ›å»ºè¿ç§»è„šæœ¬ï¼ˆå¦‚éœ€è¦ï¼‰

---

## 10. å¼€å‘æŠ€å·§å’Œæœ€ä½³å®è·µ

### 10.1 ä»£ç æœç´¢

```bash
# æœç´¢å‡½æ•°å®šä¹‰
grep -r "function_name" src/

# æœç´¢åŒ…å«ç‰¹å®šå¤´æ–‡ä»¶
grep -r "#include.*header" src/

# ä½¿ç”¨ ripgrepï¼ˆæ›´å¿«ï¼‰
rg "pattern" src/
```

### 10.2 ç†è§£ä»£ç æµç¨‹

1. **ä»å…¥å£å¼€å§‹**ï¼š`src/lms/main.cpp`
2. **è·Ÿè¸ªè°ƒç”¨é“¾**ï¼šä½¿ç”¨ IDE çš„"è½¬åˆ°å®šä¹‰"
3. **é˜…è¯»æ¥å£**ï¼šå…ˆçœ‹æ¥å£ï¼Œå†çœ‹å®ç°
4. **æŸ¥çœ‹æµ‹è¯•**ï¼šæµ‹è¯•ä»£ç æ˜¯æœ€å¥½çš„æ–‡æ¡£

### 10.3 æ€§èƒ½ä¼˜åŒ–

1. **ä½¿ç”¨æ€§èƒ½åˆ†æå·¥å…·**ï¼š
   ```bash
   perf record ./build/src/lms/lms
   perf report
   ```

2. **æ•°æ®åº“æŸ¥è¯¢ä¼˜åŒ–**ï¼š
   - ä½¿ç”¨ç´¢å¼•
   - é¿å… N+1 æŸ¥è¯¢
   - ä½¿ç”¨ EXPLAIN QUERY PLAN

3. **å†…å­˜ç®¡ç†**ï¼š
   - ä½¿ç”¨æ™ºèƒ½æŒ‡é’ˆ
   - é¿å…ä¸å¿…è¦çš„æ‹·è´
   - ä½¿ç”¨ç§»åŠ¨è¯­ä¹‰

### 10.4 æ–‡æ¡£ç¼–å†™

- **ä»£ç æ³¨é‡Š**ï¼šè§£é‡Š"ä¸ºä»€ä¹ˆ"ï¼Œè€Œä¸æ˜¯"æ˜¯ä»€ä¹ˆ"
- **å‡½æ•°æ–‡æ¡£**ï¼šè¯´æ˜å‚æ•°ã€è¿”å›å€¼ã€å¼‚å¸¸
- **README æ›´æ–°**ï¼šå¦‚æœ‰é‡å¤§å˜æ›´

---

## 11. æ•…éšœæ’é™¤

### 11.1 ç¼–è¯‘é”™è¯¯

1. **æ£€æŸ¥ä¾èµ–**ï¼šç¡®ä¿æ‰€æœ‰ä¾èµ–å·²å®‰è£…
2. **æ¸…ç†æ„å»º**ï¼š`rm -rf build && mkdir build`
3. **æŸ¥çœ‹è¯¦ç»†è¾“å‡º**ï¼š`make VERBOSE=1`

### 11.2 è¿è¡Œæ—¶é”™è¯¯

1. **æŸ¥çœ‹æ—¥å¿—**ï¼šæ£€æŸ¥æ—¥å¿—è¾“å‡º
2. **ä½¿ç”¨è°ƒè¯•å™¨**ï¼šGDB æˆ– VS Code
3. **æ£€æŸ¥é…ç½®**ï¼šéªŒè¯é…ç½®æ–‡ä»¶

### 11.3 æµ‹è¯•å¤±è´¥

1. **å•ç‹¬è¿è¡Œæµ‹è¯•**ï¼š`ctest -R TestName -V`
2. **æ£€æŸ¥æµ‹è¯•æ•°æ®**ï¼šç¡®ä¿æµ‹è¯•æ•°æ®å­˜åœ¨
3. **æŸ¥çœ‹æµ‹è¯•è¾“å‡º**ï¼šæ£€æŸ¥é”™è¯¯ä¿¡æ¯

---

## 12. èµ„æºé“¾æ¥

### å®˜æ–¹æ–‡æ¡£

- **Wt æ¡†æ¶**ï¼šhttps://www.webtoolkit.eu/wt/doc/
- **CMake**ï¼šhttps://cmake.org/documentation/
- **C++20**ï¼šhttps://en.cppreference.com/

### é¡¹ç›®ç›¸å…³

- **GitHub ä»“åº“**ï¼šhttps://github.com/epoupon/lms
- **Issues**ï¼šhttps://github.com/epoupon/lms/issues
- **Discussions**ï¼šhttps://github.com/epoupon/lms/discussions

---

## âœ… å¼€å‘æ£€æŸ¥æ¸…å•

å¼€å§‹å¼€å‘å‰ï¼š
- [ ] ç¯å¢ƒå·²é…ç½®
- [ ] é¡¹ç›®èƒ½å¤Ÿç¼–è¯‘
- [ ] æµ‹è¯•èƒ½å¤Ÿè¿è¡Œ
- [ ] IDE å·²é…ç½®

å¼€å‘è¿‡ç¨‹ä¸­ï¼š
- [ ] ä»£ç éµå¾ªé£æ ¼è§„èŒƒ
- [ ] å®šæœŸç¼–è¯‘æµ‹è¯•
- [ ] æ·»åŠ å¿…è¦çš„æ³¨é‡Š
- [ ] ç¼–å†™æˆ–æ›´æ–°æµ‹è¯•

æäº¤å‰ï¼š
- [ ] ä»£ç æ ¼å¼åŒ–
- [ ] æ‰€æœ‰æµ‹è¯•é€šè¿‡
- [ ] æäº¤ä¿¡æ¯æ¸…æ™°
- [ ] æ²¡æœ‰è°ƒè¯•ä»£ç 

---

ç¥ä½ å¼€å‘é¡ºåˆ©ï¼ğŸ’»ğŸµ

